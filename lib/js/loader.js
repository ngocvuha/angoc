(function(){var v=this,P=v._,r={},m=Array.prototype,s=Object.prototype,D=m.push,k=m.slice,t=m.concat,p=s.toString,Q=s.hasOwnProperty,E=m.forEach,F=m.map,G=m.reduce,H=m.reduceRight,I=m.filter,J=m.every,K=m.some,u=m.indexOf,L=m.lastIndexOf,s=Array.isArray,M=Object.keys,w=Function.prototype.bind,b=function(a){if(a instanceof b)return a;if(!(this instanceof b))return new b(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=b),exports._=
b):v._=b;b.VERSION="1.6.0";var l=b.each=b.forEach=function(a,d,c){if(null==a)return a;if(E&&a.forEach===E)a.forEach(d,c);else if(a.length===+a.length)for(var e=0,f=a.length;e<f;e++){if(d.call(c,a[e],e,a)===r)return}else for(var g=b.keys(a),e=0,f=g.length;e<f;e++)if(d.call(c,a[g[e]],g[e],a)===r)return;return a};b.map=b.collect=function(a,d,b){var e=[];if(null==a)return e;if(F&&a.map===F)return a.map(d,b);l(a,function(a,g,h){e.push(d.call(b,a,g,h))});return e};b.reduce=b.foldl=b.inject=function(a,d,
c,e){var f=2<arguments.length;null==a&&(a=[]);if(G&&a.reduce===G)return e&&(d=b.bind(d,e)),f?a.reduce(d,c):a.reduce(d);l(a,function(a,b,n){f?c=d.call(e,c,a,b,n):(c=a,f=!0)});if(!f)throw new TypeError("Reduce of empty array with no initial value");return c};b.reduceRight=b.foldr=function(a,d,c,e){var f=2<arguments.length;null==a&&(a=[]);if(H&&a.reduceRight===H)return e&&(d=b.bind(d,e)),f?a.reduceRight(d,c):a.reduceRight(d);var g=a.length;if(g!==+g)var h=b.keys(a),g=h.length;l(a,function(b,k,l){k=h?
h[--g]:--g;f?c=d.call(e,c,a[k],k,l):(c=a[k],f=!0)});if(!f)throw new TypeError("Reduce of empty array with no initial value");return c};b.find=b.detect=function(a,d,b){var e;N(a,function(a,g,h){if(d.call(b,a,g,h))return e=a,!0});return e};b.filter=b.select=function(a,d,b){var e=[];if(null==a)return e;if(I&&a.filter===I)return a.filter(d,b);l(a,function(a,g,h){d.call(b,a,g,h)&&e.push(a)});return e};b.reject=function(a,d,c){return b.filter(a,function(a,b,g){return!d.call(c,a,b,g)},c)};b.every=b.all=
function(a,d,c){d||(d=b.identity);var e=!0;if(null==a)return e;if(J&&a.every===J)return a.every(d,c);l(a,function(a,b,h){if(!(e=e&&d.call(c,a,b,h)))return r});return!!e};var N=b.some=b.any=function(a,d,c){d||(d=b.identity);var e=!1;if(null==a)return e;if(K&&a.some===K)return a.some(d,c);l(a,function(a,b,h){if(e||(e=d.call(c,a,b,h)))return r});return!!e};b.contains=b.include=function(a,d){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(d):N(a,function(a){return a===d})};b.invoke=function(a,d){var c=
k.call(arguments,2),e=b.isFunction(d);return b.map(a,function(a){return(e?d:a[d]).apply(a,c)})};b.pluck=function(a,d){return b.map(a,b.property(d))};b.where=function(a,d){return b.filter(a,b.matches(d))};b.findWhere=function(a,d){return b.find(a,b.matches(d))};b.max=function(a,d,c){if(!d&&b.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);var e=-Infinity,f=-Infinity;l(a,function(a,b,n){b=d?d.call(c,a,b,n):a;b>f&&(e=a,f=b)});return e};b.min=function(a,d,c){if(!d&&b.isArray(a)&&
a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);var e=Infinity,f=Infinity;l(a,function(a,b,n){b=d?d.call(c,a,b,n):a;b<f&&(e=a,f=b)});return e};b.shuffle=function(a){var d,c=0,e=[];l(a,function(a){d=b.random(c++);e[c-1]=e[d];e[d]=a});return e};b.sample=function(a,d,c){return null==d||c?(a.length!==+a.length&&(a=b.values(a)),a[b.random(a.length-1)]):b.shuffle(a).slice(0,Math.max(0,d))};var x=function(a){return null==a?b.identity:b.isFunction(a)?a:b.property(a)};b.sortBy=function(a,d,c){d=
x(d);return b.pluck(b.map(a,function(a,b,g){return{value:a,index:b,criteria:d.call(c,a,b,g)}}).sort(function(a,d){var b=a.criteria,c=d.criteria;if(b!==c){if(b>c||void 0===b)return 1;if(b<c||void 0===c)return-1}return a.index-d.index}),"value")};var y=function(a){return function(d,b,e){var f={};b=x(b);l(d,function(g,h){var n=b.call(e,g,h,d);a(f,n,g)});return f}};b.groupBy=y(function(a,d,c){b.has(a,d)?a[d].push(c):a[d]=[c]});b.indexBy=y(function(a,b,c){a[b]=c});b.countBy=y(function(a,d){b.has(a,d)?
a[d]++:a[d]=1});b.sortedIndex=function(a,b,c,e){c=x(c);b=c.call(e,b);for(var f=0,g=a.length;f<g;){var h=f+g>>>1;c.call(e,a[h])<b?f=h+1:g=h}return f};b.toArray=function(a){return a?b.isArray(a)?k.call(a):a.length===+a.length?b.map(a,b.identity):b.values(a):[]};b.size=function(a){return null==a?0:a.length===+a.length?a.length:b.keys(a).length};b.first=b.head=b.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:k.call(a,0,b)};b.initial=function(a,b,c){return k.call(a,0,a.length-(null==
b||c?1:b))};b.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:k.call(a,Math.max(a.length-b,0))};b.rest=b.tail=b.drop=function(a,b,c){return k.call(a,null==b||c?1:b)};b.compact=function(a){return b.filter(a,b.identity)};var O=function(a,d,c){if(d&&b.every(a,b.isArray))return t.apply(c,a);l(a,function(a){b.isArray(a)||b.isArguments(a)?d?D.apply(c,a):O(a,d,c):c.push(a)});return c};b.flatten=function(a,b){return O(a,b,[])};b.without=function(a){return b.difference(a,k.call(arguments,
1))};b.partition=function(a,b){var c=[],e=[];l(a,function(a){(b(a)?c:e).push(a)});return[c,e]};b.uniq=b.unique=function(a,d,c,e){b.isFunction(d)&&(e=c,c=d,d=!1);c=c?b.map(a,c,e):a;var f=[],g=[];l(c,function(c,e){(d?e&&g[g.length-1]===c:b.contains(g,c))||(g.push(c),f.push(a[e]))});return f};b.union=function(){return b.uniq(b.flatten(arguments,!0))};b.intersection=function(a){var d=k.call(arguments,1);return b.filter(b.uniq(a),function(a){return b.every(d,function(d){return b.contains(d,a)})})};b.difference=
function(a){var d=t.apply(m,k.call(arguments,1));return b.filter(a,function(a){return!b.contains(d,a)})};b.zip=function(){for(var a=b.max(b.pluck(arguments,"length").concat(0)),d=Array(a),c=0;c<a;c++)d[c]=b.pluck(arguments,""+c);return d};b.object=function(a,b){if(null==a)return{};for(var c={},e=0,f=a.length;e<f;e++)b?c[a[e]]=b[e]:c[a[e][0]]=a[e][1];return c};b.indexOf=function(a,d,c){if(null==a)return-1;var e=0,f=a.length;if(c)if("number"==typeof c)e=0>c?Math.max(0,f+c):c;else return e=b.sortedIndex(a,
d),a[e]===d?e:-1;if(u&&a.indexOf===u)return a.indexOf(d,c);for(;e<f;e++)if(a[e]===d)return e;return-1};b.lastIndexOf=function(a,b,c){if(null==a)return-1;var e=null!=c;if(L&&a.lastIndexOf===L)return e?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=e?c:a.length;c--;)if(a[c]===b)return c;return-1};b.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var e=Math.max(Math.ceil((b-a)/c),0),f=0,g=Array(e);f<e;)g[f++]=a,a+=c;return g};var z=function(){};b.bind=function(a,d){var c,e;if(w&&
a.bind===w)return w.apply(a,k.call(arguments,1));if(!b.isFunction(a))throw new TypeError;c=k.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(d,c.concat(k.call(arguments)));z.prototype=a.prototype;var b=new z;z.prototype=null;var g=a.apply(b,c.concat(k.call(arguments)));return Object(g)===g?g:b}};b.partial=function(a){var d=k.call(arguments,1);return function(){for(var c=0,e=d.slice(),f=0,g=e.length;f<g;f++)e[f]===b&&(e[f]=arguments[c++]);for(;c<arguments.length;)e.push(arguments[c++]);
return a.apply(this,e)}};b.bindAll=function(a){var d=k.call(arguments,1);if(0===d.length)throw Error("bindAll must be passed function names");l(d,function(d){a[d]=b.bind(a[d],a)});return a};b.memoize=function(a,d){var c={};d||(d=b.identity);return function(){var e=d.apply(this,arguments);return b.has(c,e)?c[e]:c[e]=a.apply(this,arguments)}};b.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};b.defer=function(a){return b.delay.apply(b,[a,1].concat(k.call(arguments,
1)))};b.throttle=function(a,d,c){var e,f,g,h=null,n=0;c||(c={});var k=function(){n=!1===c.leading?0:b.now();h=null;g=a.apply(e,f);e=f=null};return function(){var l=b.now();n||!1!==c.leading||(n=l);var m=d-(l-n);e=this;f=arguments;0>=m?(clearTimeout(h),h=null,n=l,g=a.apply(e,f),e=f=null):h||!1===c.trailing||(h=setTimeout(k,m));return g}};b.debounce=function(a,d,c){var e,f,g,h,k,l=function(){var m=b.now()-h;m<d?e=setTimeout(l,d-m):(e=null,c||(k=a.apply(g,f),g=f=null))};return function(){g=this;f=arguments;
h=b.now();var m=c&&!e;e||(e=setTimeout(l,d));m&&(k=a.apply(g,f),g=f=null);return k}};b.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;c=a.apply(this,arguments);a=null;return c}};b.wrap=function(a,d){return b.partial(d,a)};b.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};b.after=function(a,b){return function(){if(1>--a)return b.apply(this,arguments)}};b.keys=function(a){if(!b.isObject(a))return[];
if(M)return M(a);var d=[],c;for(c in a)b.has(a,c)&&d.push(c);return d};b.values=function(a){for(var d=b.keys(a),c=d.length,e=Array(c),f=0;f<c;f++)e[f]=a[d[f]];return e};b.pairs=function(a){for(var d=b.keys(a),c=d.length,e=Array(c),f=0;f<c;f++)e[f]=[d[f],a[d[f]]];return e};b.invert=function(a){for(var d={},c=b.keys(a),e=0,f=c.length;e<f;e++)d[a[c[e]]]=c[e];return d};b.functions=b.methods=function(a){var d=[],c;for(c in a)b.isFunction(a[c])&&d.push(c);return d.sort()};b.extend=function(a){l(k.call(arguments,
1),function(b){if(b)for(var c in b)a[c]=b[c]});return a};b.pick=function(a){var b={},c=t.apply(m,k.call(arguments,1));l(c,function(c){c in a&&(b[c]=a[c])});return b};b.omit=function(a){var d={},c=t.apply(m,k.call(arguments,1)),e;for(e in a)b.contains(c,e)||(d[e]=a[e]);return d};b.defaults=function(a){l(k.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])});return a};b.clone=function(a){return b.isObject(a)?b.isArray(a)?a.slice():b.extend({},a):a};b.tap=function(a,b){b(a);
return a};var A=function(a,d,c,e){if(a===d)return 0!==a||1/a==1/d;if(null==a||null==d)return a===d;a instanceof b&&(a=a._wrapped);d instanceof b&&(d=d._wrapped);var f=p.call(a);if(f!=p.call(d))return!1;switch(f){case "[object String]":return a==String(d);case "[object Number]":return a!=+a?d!=+d:0==a?1/a==1/d:a==+d;case "[object Date]":case "[object Boolean]":return+a==+d;case "[object RegExp]":return a.source==d.source&&a.global==d.global&&a.multiline==d.multiline&&a.ignoreCase==d.ignoreCase}if("object"!=
typeof a||"object"!=typeof d)return!1;for(var g=c.length;g--;)if(c[g]==a)return e[g]==d;var g=a.constructor,h=d.constructor;if(g!==h&&!(b.isFunction(g)&&g instanceof g&&b.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in d)return!1;c.push(a);e.push(d);g=0;h=!0;if("[object Array]"==f){if(g=a.length,h=g==d.length)for(;g--&&(h=A(a[g],d[g],c,e)););}else{for(var k in a)if(b.has(a,k)&&(g++,!(h=b.has(d,k)&&A(a[k],d[k],c,e))))break;if(h){for(k in d)if(b.has(d,k)&&!g--)break;h=!g}}c.pop();
e.pop();return h};b.isEqual=function(a,b){return A(a,b,[],[])};b.isEmpty=function(a){if(null==a)return!0;if(b.isArray(a)||b.isString(a))return 0===a.length;for(var d in a)if(b.has(a,d))return!1;return!0};b.isElement=function(a){return!(!a||1!==a.nodeType)};b.isArray=s||function(a){return"[object Array]"==p.call(a)};b.isObject=function(a){return a===Object(a)};l("Arguments Function String Number Date RegExp".split(" "),function(a){b["is"+a]=function(b){return p.call(b)=="[object "+a+"]"}});b.isArguments(arguments)||
(b.isArguments=function(a){return!(!a||!b.has(a,"callee"))});"function"!==typeof/./&&(b.isFunction=function(a){return"function"===typeof a});b.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};b.isNaN=function(a){return b.isNumber(a)&&a!=+a};b.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==p.call(a)};b.isNull=function(a){return null===a};b.isUndefined=function(a){return void 0===a};b.has=function(a,b){return Q.call(a,b)};b.noConflict=function(){v._=P;return this};b.identity=
function(a){return a};b.constant=function(a){return function(){return a}};b.property=function(a){return function(b){return b[a]}};b.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}};b.times=function(a,b,c){for(var e=Array(Math.max(0,a)),f=0;f<a;f++)e[f]=b.call(c,f);return e};b.random=function(a,b){null==b&&(b=a,a=0);return a+Math.floor(Math.random()*(b-a+1))};b.now=Date.now||function(){return(new Date).getTime()};var q={escape:{"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};q.unescape=b.invert(q.escape);var R={escape:new RegExp("["+b.keys(q.escape).join("")+"]","g"),unescape:new RegExp("("+b.keys(q.unescape).join("|")+")","g")};b.each(["escape","unescape"],function(a){b[a]=function(b){return null==b?"":(""+b).replace(R[a],function(b){return q[a][b]})}});b.result=function(a,d){if(null!=a){var c=a[d];return b.isFunction(c)?c.call(a):c}};b.mixin=function(a){l(b.functions(a),function(d){var c=b[d]=a[d];b.prototype[d]=function(){var a=
[this._wrapped];D.apply(a,arguments);return B.call(this,c.apply(b,a))}})};var S=0;b.uniqueId=function(a){var b=++S+"";return a?a+b:b};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/(.)^/,T={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;b.template=function(a,d,c){var e;c=b.defaults({},c,b.templateSettings);var f=new RegExp([(c.escape||C).source,(c.interpolate||C).source,
(c.evaluate||C).source].join("|")+"|$","g"),g=0,h="__p+='";a.replace(f,function(b,c,d,e,f){h+=a.slice(g,f).replace(U,function(a){return"\\"+T[a]});c&&(h+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'");d&&(h+="'+\n((__t=("+d+"))==null?'':__t)+\n'");e&&(h+="';\n"+e+"\n__p+='");g=f+b.length;return b});h+="';\n";c.variable||(h="with(obj||{}){\n"+h+"}\n");h="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{e=new Function(c.variable||"obj",
"_",h)}catch(k){throw k.source=h,k;}if(d)return e(d,b);d=function(a){return e.call(this,a,b)};d.source="function("+(c.variable||"obj")+"){\n"+h+"}";return d};b.chain=function(a){return b(a).chain()};var B=function(a){return this._chain?b(a).chain():a};b.mixin(b);l("pop push reverse shift sort splice unshift".split(" "),function(a){var d=m[a];b.prototype[a]=function(){var b=this._wrapped;d.apply(b,arguments);"shift"!=a&&"splice"!=a||0!==b.length||delete b[0];return B.call(this,b)}});l(["concat","join",
"slice"],function(a){var d=m[a];b.prototype[a]=function(){return B.call(this,d.apply(this._wrapped,arguments))}});b.extend(b.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}});"function"===typeof define&&define.amd&&define("underscore",[],function(){return b})}).call(this);
(function(n){function K(p,q){function s(a){if(s[a]!==v)return s[a];var c;if("bug-string-char-index"==a)c="a"!="a"[0];else if("json"==a)c=s("json-stringify")&&s("json-parse");else{var e;if("json-stringify"==a){c=q.stringify;var b="function"==typeof c&&r;if(b){(e=function(){return 1}).toJSON=e;try{b="0"===c(0)&&"0"===c(new A)&&'""'==c(new B)&&c(t)===v&&c(v)===v&&c()===v&&"1"===c(e)&&"[1]"==c([e])&&"[null]"==c([v])&&"null"==c(null)&&"[null,null,null]"==c([v,t,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==
c({a:[e,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===c(null,e)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new D(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==c(new D(864E13))&&'"-000001-01-01T00:00:00.000Z"'==c(new D(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==c(new D(-1))}catch(f){b=!1}}c=b}if("json-parse"==a){c=q.parse;if("function"==typeof c)try{if(0===c("0")&&!c(!1)){e=c('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==e.a.length&&1===e.a[0];if(l){try{l=!c('"\t"')}catch(d){}if(l)try{l=
1!==c("01")}catch(h){}if(l)try{l=1!==c("1.")}catch(m){}}}}catch(X){l=!1}c=l}}return s[a]=!!c}p||(p=n.Object());q||(q=n.Object());var A=p.Number||n.Number,B=p.String||n.String,G=p.Object||n.Object,D=p.Date||n.Date,J=p.SyntaxError||n.SyntaxError,N=p.TypeError||n.TypeError,R=p.Math||n.Math,H=p.JSON||n.JSON;"object"==typeof H&&H&&(q.stringify=H.stringify,q.parse=H.parse);var G=G.prototype,t=G.toString,u,C,v,r=new D(-0xc782b5b800cec);try{r=-109252==r.getUTCFullYear()&&0===r.getUTCMonth()&&1===r.getUTCDate()&&
10==r.getUTCHours()&&37==r.getUTCMinutes()&&6==r.getUTCSeconds()&&708==r.getUTCMilliseconds()}catch(Y){}if(!s("json")){var E=s("bug-string-char-index");if(!r)var w=R.floor,S=[0,31,59,90,120,151,181,212,243,273,304,334],F=function(a,c){return S[c]+365*(a-1970)+w((a-1969+(c=+(1<c)))/4)-w((a-1901+c)/100)+w((a-1601+c)/400)};(u=G.hasOwnProperty)||(u=function(a){var c={},e;(c.__proto__=null,c.__proto__={toString:1},c).toString!=t?u=function(a){var c=this.__proto__;a=a in(this.__proto__=null,this);this.__proto__=
c;return a}:(e=c.constructor,u=function(a){var c=(this.constructor||e).prototype;return a in this&&!(a in c&&this[a]===c[a])});c=null;return u.call(this,a)});var T={"boolean":1,number:1,string:1,undefined:1};C=function(a,c){var e=0,b,f,l;(b=function(){this.valueOf=0}).prototype.valueOf=0;f=new b;for(l in f)u.call(f,l)&&e++;b=f=null;e?C=2==e?function(a,c){var e={},b="[object Function]"==t.call(a),f;for(f in a)b&&"prototype"==f||u.call(e,f)||!(e[f]=1)||!u.call(a,f)||c(f)}:function(a,c){var e="[object Function]"==
t.call(a),b,f;for(b in a)e&&"prototype"==b||!u.call(a,b)||(f="constructor"===b)||c(b);(f||u.call(a,b="constructor"))&&c(b)}:(f="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),C=function(a,c){var e="[object Function]"==t.call(a),b,g;if(g=!e)if(g="function"!=typeof a.constructor)g=typeof a.hasOwnProperty,g="object"==g?!!a.hasOwnProperty:!T[g];g=g?a.hasOwnProperty:u;for(b in a)e&&"prototype"==b||!g.call(a,b)||c(b);for(e=f.length;b=f[--e];g.call(a,
b)&&c(b));});return C(a,c)};if(!s("json-stringify")){var U={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},x=function(a,c){return("000000"+(c||0)).slice(-a)},O=function(a){for(var c='"',b=0,g=a.length,f=!E||10<g,l=f&&(E?a.split(""):a);b<g;b++){var d=a.charCodeAt(b);switch(d){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=U[d];break;default:if(32>d){c+="\\u00"+x(2,d.toString(16));break}c+=f?l[b]:a.charAt(b)}}return c+'"'},L=function(a,c,b,g,f,l,d){var h,m,k,n,p,q,r,s,y;try{h=
c[a]}catch(z){}if("object"==typeof h&&h)if(m=t.call(h),"[object Date]"!=m||u.call(h,"toJSON"))"function"==typeof h.toJSON&&("[object Number]"!=m&&"[object String]"!=m&&"[object Array]"!=m||u.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&h<1/0){if(F){n=w(h/864E5);for(m=w(n/365.2425)+1970-1;F(m+1,0)<=n;m++);for(k=w((n-F(m,0))/30.42);F(m,k+1)<=n;k++);n=1+n-F(m,k);p=(h%864E5+864E5)%864E5;q=w(p/36E5)%24;r=w(p/6E4)%60;s=w(p/1E3)%60;p%=1E3}else m=h.getUTCFullYear(),k=h.getUTCMonth(),n=h.getUTCDate(),
q=h.getUTCHours(),r=h.getUTCMinutes(),s=h.getUTCSeconds(),p=h.getUTCMilliseconds();h=(0>=m||1E4<=m?(0>m?"-":"+")+x(6,0>m?-m:m):x(4,m))+"-"+x(2,k+1)+"-"+x(2,n)+"T"+x(2,q)+":"+x(2,r)+":"+x(2,s)+"."+x(3,p)+"Z"}else h=null;b&&(h=b.call(c,a,h));if(null===h)return"null";m=t.call(h);if("[object Boolean]"==m)return""+h;if("[object Number]"==m)return h>-1/0&&h<1/0?""+h:"null";if("[object String]"==m)return O(""+h);if("object"==typeof h){for(a=d.length;a--;)if(d[a]===h)throw N();d.push(h);y=[];c=l;l+=f;if("[object Array]"==
m){k=0;for(a=h.length;k<a;k++)m=L(k,h,b,g,f,l,d),y.push(m===v?"null":m);a=y.length?f?"[\n"+l+y.join(",\n"+l)+"\n"+c+"]":"["+y.join(",")+"]":"[]"}else C(g||h,function(a){var c=L(a,h,b,g,f,l,d);c!==v&&y.push(O(a)+":"+(f?" ":"")+c)}),a=y.length?f?"{\n"+l+y.join(",\n"+l)+"\n"+c+"}":"{"+y.join(",")+"}":"{}";d.pop();return a}};q.stringify=function(a,c,b){var g,f,l,d;if("function"==typeof c||"object"==typeof c&&c)if("[object Function]"==(d=t.call(c)))f=c;else if("[object Array]"==d){l={};for(var h=0,m=c.length,
k;h<m;k=c[h++],(d=t.call(k),"[object String]"==d||"[object Number]"==d)&&(l[k]=1));}if(b)if("[object Number]"==(d=t.call(b))){if(0<(b-=b%1))for(g="",10<b&&(b=10);g.length<b;g+=" ");}else"[object String]"==d&&(g=10>=b.length?b:b.slice(0,10));return L("",(k={},k[""]=a,k),f,l,g,"",[])}}if(!s("json-parse")){var V=B.fromCharCode,W={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},b,I,k=function(){b=I=null;throw J();},z=function(){for(var a=I,c=a.length,e,g,f,l,d;b<c;)switch(d=a.charCodeAt(b),
d){case 9:case 10:case 13:case 32:b++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=E?a.charAt(b):a[b],b++,e;case 34:e="@";for(b++;b<c;)if(d=a.charCodeAt(b),32>d)k();else if(92==d)switch(d=a.charCodeAt(++b),d){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=W[d];b++;break;case 117:g=++b;for(f=b+4;b<f;b++)d=a.charCodeAt(b),48<=d&&57>=d||97<=d&&102>=d||65<=d&&70>=d||k();e+=V("0x"+a.slice(g,b));break;default:k()}else{if(34==d)break;d=a.charCodeAt(b);for(g=b;32<=
d&&92!=d&&34!=d;)d=a.charCodeAt(++b);e+=a.slice(g,b)}if(34==a.charCodeAt(b))return b++,e;k();default:g=b;45==d&&(l=!0,d=a.charCodeAt(++b));if(48<=d&&57>=d){for(48==d&&(d=a.charCodeAt(b+1),48<=d&&57>=d)&&k();b<c&&(d=a.charCodeAt(b),48<=d&&57>=d);b++);if(46==a.charCodeAt(b)){for(f=++b;f<c&&(d=a.charCodeAt(f),48<=d&&57>=d);f++);f==b&&k();b=f}d=a.charCodeAt(b);if(101==d||69==d){d=a.charCodeAt(++b);43!=d&&45!=d||b++;for(f=b;f<c&&(d=a.charCodeAt(f),48<=d&&57>=d);f++);f==b&&k();b=f}return+a.slice(g,b)}l&&
k();if("true"==a.slice(b,b+4))return b+=4,!0;if("false"==a.slice(b,b+5))return b+=5,!1;if("null"==a.slice(b,b+4))return b+=4,null;k()}return"$"},M=function(a){var c,b;"$"==a&&k();if("string"==typeof a){if("@"==(E?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(c=[];;b||(b=!0)){a=z();if("]"==a)break;b&&(","==a?(a=z(),"]"==a&&k()):k());","==a&&k();c.push(M(a))}return c}if("{"==a){for(c={};;b||(b=!0)){a=z();if("}"==a)break;b&&(","==a?(a=z(),"}"==a&&k()):k());","!=a&&"string"==typeof a&&"@"==(E?a.charAt(0):
a[0])&&":"==z()||k();c[a.slice(1)]=M(z())}return c}k()}return a},Q=function(a,b,e){e=P(a,b,e);e===v?delete a[b]:a[b]=e},P=function(a,b,e){var g=a[b],f;if("object"==typeof g&&g)if("[object Array]"==t.call(g))for(f=g.length;f--;)Q(g,f,e);else C(g,function(a){Q(g,a,e)});return e.call(a,b,g)};q.parse=function(a,c){var e,g;b=0;I=""+a;e=M(z());"$"!=z()&&k();b=I=null;return c&&"[object Function]"==t.call(c)?P((g={},g[""]=e,g),"",c):e}}}q.runInContext=K;return q}var J="function"===typeof define&&define.amd,
A="object"==typeof global&&global;!A||A.global!==A&&A.window!==A||(n=A);if("object"!=typeof exports||!exports||exports.nodeType||J){var N=n.JSON,B=K(n,n.JSON3={noConflict:function(){n.JSON=N;return B}});n.JSON={parse:B.parse,stringify:B.stringify}}else K(n,exports);J&&define(function(){return B})})(this);
"undefined"!=typeof subiz_account_id&&0<subiz_account_id&&!window._sbzq&&(window._sbzq=[["_setAccount",subiz_account_id]]);
(function(n,s,Ya){var fb=!1,Cb=function(){var b=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(b=parseFloat(RegExp.$1));return b}();-1<Cb&&10>Cb&&(fb=!0);s.querySelector&&s.addEventListener||(fb=!0);if(fb)console.log("Subiz: Please upgrade your browser!");else{var q=n._.noConflict(),k={},g={},aa={},Za=[],Ia=s.title,$a=null,X={},F={},xa={},P=JSON3.noConflict();g.waiting_time=45;"undefined"!=typeof _sbz_is_new_window&&(g._sbz_is_new_window=
!0);"undefined"!=typeof _sbz_is_new_window_pc&&(g._sbz_is_new_window_pc=!0);k.session={};var $b=function(b,c){return c()}(this,function(){var b=function(b){b=b||{};for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])};b.prototype={constructor:b,newWindow:!0,stripPrefix:!0,twitter:!0,email:!0,urls:!0,className:"",matcherRegex:function(){var b=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,d=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/;
return new RegExp(["(",/(^|[^\w])@(\w{1,15})/.source,")|(",/(?:[\-;:&=\+\$,\w\.]+@)/.source,b.source,d.source,")|((?:(?:",/(?:[A-Za-z]{3,9}:(?:\/\/)?)/.source,b.source,")|(?:(.?//)?",/(?:www\.)/.source,b.source,")|(?:(.?//)?",b.source,d.source,"))",/(?:[\-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|])?/.source,")"].join(""),"gi")}(),protocolRelativeRegex:/(.)?\/\//,htmlRegex:new RegExp(["<(/)?","("+/[0-9a-zA-Z:]+/.source+")","(?:\\s+",/[^\s\0"'>\/=\x01-\x1F\x7F]+/.source,"(?:\\s*=\\s*"+
/(?:".*?"|'.*?'|[^'"=<>`\s]+)/.source+")?",")*\\s*>"].join(""),"g"),urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,link:function(b){return this.processHtml(b)},processHtml:function(b){for(var d=this.htmlRegex,e,f,g=0,k=0,h=[];null!==(e=d.exec(b));){var m=e[0],l=e[2],q=!!e[1];f=b.substring(g,e.index);g=e.index+m.length;"a"===l?q?(k=Math.max(k-1,0),0===k&&h.push(f)):(k++,h.push(this.processTextNode(f))):0===k?h.push(this.processTextNode(f)):h.push(f);h.push(m)}g<b.length&&(b=this.processTextNode(b.substring(g)),
h.push(b));return h.join("")},processTextNode:function(b){var d=this,e=this.twitter,f=this.email,g=this.urls;return b.replace(this.matcherRegex,function(b,c,k,h,m,l,q,n){var z=q||n;n=q="";if(c&&!e||m&&!f||l&&!g||l&&-1===l.indexOf(".")||l&&/^[A-Za-z]{3,9}:/.test(l)&&!/:.*?[A-Za-z]/.test(l)||z&&/^[\w]\/\//.test(z))return b;if(")"===b.charAt(b.length-1)){l=b.match(/\(/g);var u=b.match(/\)/g);(l&&l.length||0)<(u&&u.length||0)&&(b=b.substr(0,b.length-1),n=")")}l=b;c?(c="twitter",q=k,l="https://twitter.com/"+
h,b="@"+h):m?(c="email",l="mailto:"+m,b=m):(c="url",z?(k=new RegExp("^"+d.protocolRelativeRegex.source),q=(z.match(k)[1]||"")+q,l=l.replace(k,"//"),b=b.replace(k,"")):/^[A-Za-z]{3,9}:/i.test(l)||(l="http://"+l));k=d.createAnchorTag(c,l,b);return q+k+n})},createAnchorTag:function(b,d,e){b=this.createAnchorAttrsStr(b,d);e=this.processAnchorText(e);return"<a "+b+">"+e+"</a>"},createAnchorAttrsStr:function(b,d){var e=['href="'+d+'"'],f=this.createCssClass(b);f&&e.push('class="'+f+'"');this.newWindow&&
e.push('target="_blank"');return e.join(" ")},createCssClass:function(b){var d=this.className;return d?d+" "+d+"-"+b:""},processAnchorText:function(b){this.stripPrefix&&(b=this.stripUrlPrefix(b));b=this.removeTrailingSlash(b);return this.doTruncate(b)},stripUrlPrefix:function(b){return b.replace(this.urlPrefixRegex,"")},removeTrailingSlash:function(b){"/"===b.charAt(b.length-1)&&(b=b.slice(0,-1));return b},doTruncate:function(b){var d=this.truncate;d&&b.length>d&&(b=b.substring(0,d-2)+"..");return b}};
b.link=function(c,d){return(new b(d)).link(c)};return b}),Ca=function(){var b,c,d={};c=n.navigator.userAgent.toLowerCase();d.ios=function(){return d.iphone()||d.ipod()||d.ipad()};d.iphone=function(){return b("iphone")};d.ipod=function(){return b("ipod")};d.ipad=function(){return b("ipad")};d.android=function(){return b("android")};d.androidPhone=function(){return d.android()&&b("mobile")};d.androidTablet=function(){return d.android()&&!b("mobile")};d.blackberry=function(){return b("blackberry")||
b("bb10")||b("rim")};d.blackberryPhone=function(){return d.blackberry()&&!b("tablet")};d.blackberryTablet=function(){return d.blackberry()&&b("tablet")};d.windows=function(){return b("windows")};d.windowsPhone=function(){return d.windows()&&b("phone")};d.windowsTablet=function(){return d.windows()&&b("touch")};d.fxos=function(){return(b("(mobile;")||b("(tablet;"))&&b("; rv:")};d.fxosPhone=function(){return d.fxos()&&b("mobile")};d.fxosTablet=function(){return d.fxos()&&b("tablet")};d.meego=function(){return b("meego")};
d.mobile=function(){return d.androidPhone()||d.iphone()||d.ipod()||d.windowsPhone()||d.blackberryPhone()||d.fxosPhone()||d.meego()};d.tablet=function(){return d.ipad()||d.androidTablet()||d.blackberryTablet()||d.windowsTablet()||d.fxosTablet()};d.portrait=function(){return 90!==Math.abs(n.orientation)};d.landscape=function(){return 90===Math.abs(n.orientation)};d.detect=function(){if(d.ios()){if(d.ipad())return"tablet";if(d.iphone()||d.ipod())return"mobile"}else return d.android()?d.androidTablet()?
"tablet":"mobile":d.blackberry()?d.blackberryTablet()?"tablet":"mobile":d.windows()?d.windowsTablet()?"tablet":d.windowsPhone()?"mobile":"desktop":d.fxos()?d.fxosTablet()?"tablet":"mobile":d.meego()?"mobile":"desktop"};b=function(b){return-1!==c.indexOf(b)};return d}();(function(b,c){return c?{get:function(d){return b[d]&&c.parse(b[d])},set:function(d,e){b[d]=c.stringify(e)}}:{}})(this.localStorage||{},P);var Q=function(b,c){for(;b.tagName.toLowerCase()!=c;)if(b=b.parentNode,!b)return null;return b},
Db=s.documentElement,Eb=/^[^{]+\{\s*\[native \w/,gb=Eb.test(Db.compareDocumentPosition)||Eb.test(Db.contains)?function(b,c){var d=9===b.nodeType?b.documentElement:b,e=c&&c.parentNode;return b===e||!!(e&&1===e.nodeType&&(d.contains?d.contains(e):b.compareDocumentPosition&&b.compareDocumentPosition(e)&16))}:function(b,c){if(c)for(;c=c.parentNode;)if(c===b)return!0;return!1},Fb=function(b){return"none"===x.get(b,"display")||!gb(b.ownerDocument,b)},A=function(b,c,d){var e=c.documentElement,f=/(^\n+)|(\n+$)/g,
g=/^(?:\{.*\}|\[.*\])$/,k=/-([a-z])/ig,m=/\r\n/g,l=/[\-\+0-9\.]/ig,n=/\s+/,s=/\?/,t=/opacity=([^)]*)/,E=/^[\],:{}\s]*$/,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,z=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,u=/(?:^|:|,)(?:\s*\[)+/g,w=["height","margin-top","margin-bottom","padding-top","padding-bottom"],F={},G={},L=[],N=function(){T(L,function(b,c){c()});c.removeEventListener("DOMContentLoaded",N,!1)},Ea=function(b,d){var e=typeof d;if("string"===e){var f=(b&&b.ownerDocument||
c).createDocumentFragment(),g=Da("div");for(g.innerHTML=d;null!=g.childNodes[0];)f.appendChild(g.childNodes[0]);d=f}"number"===e&&(d+="");return d},B=function(b,c){if(null!==b){if(c===d)return b;var e=0,f=b.length;if(f!==d&&0<f){for(;e<f&&!1!==c.call(b[e],b[e],b[e++]););return b}return c.call(b,b)}},Gb=function(b,d,e,f){return B(b,function(b){var hb={},g="show"===d,k=b.style,h=b._display,K;if(!h){h=O.get(b,"display");if("none"===h||"inherit"===h)K=$(c.body,Da(b.nodeName)),h=O.get(K,"display"),ba(K);
b._display=h}g?k.display=h:h="none";e?(O.get(b,"overflow"),k.overflow="hidden",hb.opacity=g?{from:0,to:1}:{from:1,to:0},T(w,function(c,d){hb[d]=g?{from:0,to:O.get(b,d)}:0}),ib(b,hb,e,function(){T(w,function(c,d){x.set(b,d,"")});k.filter=k.opacity=k.overflow="";k.display=h;f&&f.call(b)})):k.display=h})},R=function(b,c){if("object"===typeof c){var d=[];T(c,function(c,e){"object"===typeof e?d.push(R(b+"["+c+"]",e)):d.push(b+"["+Ja(c)+"]="+Ja(e))});return d.join("&")}return Ja(b)+"="+Ja(c)},Q=c.removeEventListener?
function(b,c,d){b.removeEventListener(c,d,!1)}:function(b,c,d){b.detachEvent("on"+c,d)},ea={$:function(b,c){return b.getElementById(c)},$each:function(b,c){if("undefined"!=typeof q)return q.each(b,function(b,d){c(d,b)}),b;var d=0,e=b.length,f="object"===typeof b,g;if(f&&e-1 in b)for(;d<e&&!1!==c.call(b[d],d,b[d++]););else if(f)for(g in b)c.call(b[g],g,b[g]);else c.call(b,0,b);return b},$id:function(b,c,d){var e=[],f;T(c instanceof Array?c:c.split(" "),function(c,d){f=h(b,d);null!==f&&e.push(f)});
return d?B(e,d):e},$dom:function(b,c){c&&(b.length?B(b,c):c(b));return b},$tag:function(b,c,d){var e=[];b=b.getElementsByTagName(c);c=b.length;var f=0;if(0<c){for(;f<c;f++)e.push(b[f]);return d?B(e,d):e}return e},$class:c.getElementsByClassName?function(b,c,d){var e=[];b=b.getElementsByClassName(c);c=b.length;var f=0;if(0<c){for(;f<c;f++)e.push(b[f]);return d?B(e,d):e}return e}:function(b,c,d){var e=[],f=new RegExp("(^|\\s)"+c+"(\\s|$)");C(b,"*",function(b){f.test(b.className)&&e.push(b)});return d?
B(e,d):e},$select:c.querySelectorAll?function(b,c,d){return d?B(b.querySelectorAll(c),d):b.querySelectorAll(c)}:function(b,c,d){var e=ea.Qselector.styleSheet,f=[];e.addRule(c,"q:a");C(b,"*",function(b){"a"===b.currentStyle.q&&f.push(b)});e.cssText="";return d?B(f,d):f},$new:function(b,d){var e=c.createElement(b);if(d)try{return T(d,function(b,c){switch(b){case "css":case "style":x.set(e,c);break;case "innerHTML":case "html":H(e,c);break;case "className":case "class":y.set(e,c);break;case "text":jb(e,
c);break;default:D.set(e,b,c)}}),e}catch(f){}finally{e=null}return e},$string:{camelCase:function(b){return b.replace("-ms-","ms-").replace(k,function(b,c){return(c+"").toUpperCase()})},replace:function(b,c){for(var d in c)b=b.replace(new RegExp(d,"ig"),c[d]);return b},slashes:function(b){return U.replace(b,{"\\\\":"\\\\","\b":"\\b","\t":"\\t","\n":"\\n","\r":"\\r",'"':'\\"'})},trim:"".trim?function(b){return b.trim()}:function(b){return(b+"").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}},$attr:{get:function(b,
c){return b.getAttribute(c)},set:function(b,c,d){return B(b,function(b){b.setAttribute(c,d)})},remove:function(b,c){return B(b,function(b){b.removeAttribute(c)})}},$data:{get:function(b,c){var d=D.get(b,"data-"+c);return"true"===d?!0:"false"===d?!1:"null"===d?"":null===d?"":""===d?"":!isNaN(parseFloat(d))&&isFinite(d)?+d:g.test(d)?V.decode(d):d},set:function(b,c,d){return B(b,function(b){d="object"===typeof d?V.encode(d):d;"object"===typeof c?T(c,function(c,d){D.set(b,"data-"+c,d)}):D.set(b,"data-"+
c,d);return b})},remove:function(b,c){return B(b,function(b){D.remove(b,"data-"+c)})}},$storage:b.localStorage?{set:function(b,c){localStorage[b]="object"===typeof c?V.encode(c):c},get:function(b){b=localStorage[b];return V.isJSON(b)?V.decode(b):b||""},remove:function(b){localStorage.removeItem(b);return!0}}:{set:function(b,c){c="object"===typeof c?V.encode(c):c;kb.set(ea.storage,b,c);ea.storage.save("Qstorage")},get:function(b){ea.storage.load("Qstorage");return kb.get(ea.storage,b)||""},remove:function(b){ea.storage.load("Qstorage");
kb.remove(ea.storage,b);return!0}},$event:{guid:0,global:{},handler:{call:function(b,c,d,e){b=p.handler;d.currentTarget=c;if(!1===e||!1===e.call(c,d))b.stopPropagation.call(d),b.preventDefault.call(d)},preventDefault:function(){var b=this.originalEvent;b.preventDefault&&b.preventDefault()},stopPropagation:function(){var b=this.originalEvent;b.stopPropagation&&b.stopPropagation()},stopImmediatePropagation:function(){this.stopPropagation()},mouseenter:function(b){return function(c){var d=c.relatedTarget;
if(this!==d){for(;d&&d!==this;)d=d.parentNode;d!==this&&b.call(this,c)}}}},on:function(b,e,f,g,k){return B(b,function(b){if(3===b.nodeType||8===b.nodeType)return!1;if("object"===typeof e){"string"!==typeof f&&(g=g||f,f=d);for(type in e)p.on(b,type,f,g,e[type]);return this}null==g&&null==k?(k=f,g=f=d):null==k&&("string"===typeof f?(k=g,g=d):(k=g,g=f,f=d));b.guid===d&&(p.guid++,b.guid=p.guid,p.global[p.guid]={});var h=b.guid,S=(f||"")+e;p.global[h][S]||(p.global[h][S]={});delegate_fn=function(e){var K=
{},ca,h;T("altKey bubbles button buttons cancelable relatedTarget clientX clientY ctrlKey fromElement offsetX offsetY pageX pageY screenX screenY shiftKey toElement timeStamp".split(" "),function(b,c){e[c]!==d&&(K[c]=e[c])});K.originalEvent=e;K.preventDefault=p.handler.preventDefault;K.stopPropagation=p.handler.stopPropagation;K.stopImmediatePropagation=p.handler.stopImmediatePropagation;K.delegateTarget=b;K.data=g;h=K.target=f?e.target||e.srcElement||c:b;K.which=e.which||e.charCode||e.keyCode;K.metaKey=
e.metaKey||e.ctrlKey;if(f)for(ca=f?f.replace(".",""):"";h!==b;h=h.parentNode){if(null===h||h===c.body)return!1;(h.tagName.toLowerCase()===f||y.has(h,ca))&&p.handler.call(e,h,K,k)}else p.handler.call(e,h,K,k)};if(b.addEventListener){if("mouseenter"===e||"mouseleave"===e)e="mouseenter"===e?"mouseover":"mouseout",delegate_fn=p.handler.mouseenter(delegate_fn);b.addEventListener(e,delegate_fn,"blur"===e||"focus"===e)}else b.attachEvent("on"+e,delegate_fn);p.global[h][S][k+""]=delegate_fn;return b})},off:function(b,
c,d,e){if("object"===typeof c){for(type in c)p.off(b,type,c[type]);return this}null==e&&(e=d,d=null);var f=b.guid;d=(d||"")+c;fn_key=e+"";e?(Q(b,c,p.global[f][d][fn_key]),delete p.global[f][d][fn_key]):(T(p.global[f][d],function(d,e){Q(b,c,e)}),delete p.global[f][d])}},$clear:function(b){b&&(clearTimeout(b),clearInterval(b));return null},$ready:function(b){if("complete"===c.readyState)return setTimeout(b,1);if(c.addEventListener)L.push(b),c.addEventListener("DOMContentLoaded",N,!1);else{var d=function(){try{e.doScroll("left")}catch(c){setTimeout(d,
1);return}b()};d()}},$css:{get:function(b,c){if("object"===typeof c){var d={};T(c,function(c,e){d[e]=O.get(b,e)});return d}return O.get(b,c)},set:function(b,c,d){return B(b,function(b){"object"===typeof c?T(c,function(c,d){O.set(b,U.camelCase(c),x.fix(c,d))}):O.set(b,U.camelCase(c),x.fix(c,d));return b})},number:{fontWeight:!0,lineHeight:!0,opacity:!0,zIndex:!0},unit:function(b,c){if(x.number[b])return"";var d=(c+"").replace(l,"");return""===d?"px":d},fix:function(b,c){"number"!==typeof c||x.number[b]||
(c+="px");return null===c&&isNaN(c)?!1:c}},$style:{get:b.getComputedStyle?function(b,d){if(null!==b){var e=c.defaultView.getComputedStyle(b,null).getPropertyValue(d);return"auto"===e||""===e?0:e}return!1}:function(b,c){if(null!==b){var d="opacity"===c?t.test(b.currentStyle.filter)?.01*parseFloat(RegExp.$1)+"":1:b.currentStyle[U.camelCase(c)];return"auto"===d?0:d}return!1},set:e.style.opacity!==d?function(b,c,d){return B(b,function(b){b.style[c]=d;return!0})}:function(b,c,d){return B(b,function(b){b.currentStyle&&
b.currentStyle.hasLayout||(b.style.zoom=1);"opacity"===c?(b.style.filter="alpha(opacity="+100*d+")",b.style.zoom=1):b.style[c]=d;return!0})}},$pos:function(b,c,d){return B(b,function(b){O.set(b,"left",c+"px");O.set(b,"top",d+"px");return b})},$offset:function(d){var f=c.body,g=d.getBoundingClientRect();return{top:g.top+(b.scrollY||f.parentNode.scrollTop||d.scrollTop)-(e.clientTop||f.clientTop||0),left:g.left+(b.scrollX||f.parentNode.scrollLeft||d.scrollLeft)-(e.clientLeft||f.clientLeft||0),width:d.offsetWidth,
height:d.offsetHeight}},$append:function(b,c){return B(b,function(b){return b.appendChild(Ea(b,c))})},$prepend:function(b,c){return B(b,function(b){return b.firstChild?b.insertBefore(Ea(b,c),b.firstChild):b.appendChild(Ea(b,c))})},$before:function(b,c){return B(b,function(b){return b.parentNode.insertBefore(Ea(b,c),b)})},$after:function(b,c){return B(b,function(b){return b.nextSibling?b.parentNode.insertBefore(Ea(b,c),b.nextSibling):b.parentNode.appendChild(Ea(b,c))})},$remove:function(b){return B(b,
function(b){lb(b);b.guid!==d&&delete p.global[b.guid];return null!==b&&b.parentNode?b.parentNode.removeChild(b):b})},$empty:function(b){return B(b,function(b){for(;b.firstChild;)1===b.nodeType&&b.guid!==d&&delete p.global[b.guid],b.removeChild(b.firstChild);return b})},$html:function(b,c){return B(b,function(b){if(c){try{b.innerHTML=c}catch(d){$(lb(b),c)}return b}return 1===b.nodeType?b.innerHTML:null})},$text:function(b,d){return B(b,function(b){if(d)return lb(b),b.appendChild(c.createTextNode(d)),
b;var e="",g=b.textContent;if((g||b.innerText)===b.innerHTML)e=g?U.trim(b.textContent.replace(f,"")):b.innerText.replace(m,"");else for(b=b.firstChild;b;b=b.nextSibling)if(g=b.nodeType,3===g&&""!==U.trim(b.nodeValue)&&(e+=b.nodeValue.replace(f,"")+(b.nextSibling&&b.nextSibling.tagName&&"br"!==b.nextSibling.tagName.toLowerCase()?"\n":"")),1===g||2===g)e+=jb(b)+("block"===O.get(b,"display")||"br"===b.tagName.toLowerCase()?"\n":"");return e})},$className:{add:function(b,c){return B(b,function(b){if(""===
b.className)b.className=c;else{var d=b.className,e=[];T(c.split(n),function(b,c){(new RegExp("\\b("+c+")\\b")).test(d)||e.push(" "+c)});b.className+=e.join("")}return b})},set:function(b,c){return B(b,function(b){b.className=c;return b})},has:function(b,c){return(new RegExp("\\b("+c.split(n).join("|")+")\\b")).test(b.className)},remove:function(b,c){return B(b,function(b){b.className=c?U.trim(b.className.replace(new RegExp("\\b("+c.split(n).join("|")+")\\b"),"").split(n).join(" ")):"";return b})}},
$hide:function(b,c,d){Gb(b,"hide",c,d)},$show:function(b,c,d){Gb(b,"show",c,d)},$toggle:function(b,c,d){return B(b,function(b){"none"===O.get(b,"display")?v(b,c,d):r(b,c,d)})},$animate:function(){var b=e.style;return b.webkitTransition!==d||b.MozTransition!==d||b.OTransition!==d||b.msTransition!==d||b.transition!==d}()?function(){var b=e.style,c=(b.webkitTransition!==d?"Webkit":b.MozTransition!==d?"Moz":b.OTransition!==d?"O":b.msTransition!==d?"ms":"")+"Transition";return function(b,e,f,g){return B(b,
function(b){var k=[],h=[],K=[],ca=[],da=b.style,I;f=f||300;for(I in e)h[I]=U.camelCase(I),e[I].from!==d?(e[I].to=e[I].to||0,k[I]=x.number[I]?e[I].to:parseInt(e[I].to,10),K[I]=x.unit(I,e[I].to),O.set(b,h[I],parseInt(e[I].from,10)+K[I])):(k[I]=x.number[I]?e[I]:parseInt(e[I],10),K[I]=x.unit(I,e[I]),O.set(b,h[I],O.get(b,h[I]))),ca.push(I);setTimeout(function(){da[c]="all "+f+"ms";T(ca,function(b,c){da[h[c]]=k[c]+K[c]})},15);setTimeout(function(){da[c]="";g&&g.call(b)},f);return b})}}():function(b,c,e,
f){return B(b,function(b){var g=0,h=0,k=0,S=0,K=[],ca=[],da=[],I=[],m=[],l;e=e||300;for(l in c)da.push(U.camelCase(l)),c[l].from!==d?(k=c[l].to,ca.push(x.number[l]?c[l].from:parseInt(c[l].from,10)),O.set(b,da[h],ca[h]+x.unit(l,k))):(k=c[l],ca.push(parseInt(O.get(b,U.camelCase(l)),10))),K.push(x.number[l]?k:parseInt(k,10)),I.push(x.unit(l,k)),h++,S++;for(k=0;30>k;k++)for(m[k]=[],h=0;h<S;h++)m[k][da[h]]=ca[h]+(K[h]-ca[h])/30*k+("opacity"===da[h]?"":I[h]);for(;30>h;h++)setTimeout(function(){for(h=0;h<
S;h++)O.set(b,da[h],m[g][da[h]]);g++},e/30*h);setTimeout(function(){for(h=0;h<S;h++)O.set(b,da[h],K[h]+I[h]);f&&f.call(b)},e);return b})},$fadeout:function(b,c,d){return B(b,function(b){ib(b,{opacity:{from:1,to:0}},c||500,d)})},$fadein:function(b,c,d){return B(b,function(b){ib(b,{opacity:{from:0,to:1}},c||500,d)})},$cookie:{get:function(b){for(var d=c.cookie.split("; "),e=0,f=d.length,g;e<f;e++)if(g=d[e].split("="),g[0]===b)return b=decodeURIComponent(g[1]),V.isJSON(b)?V.decode(b):b+"";return null},
set:function(b,d,e){if("object"===typeof b)return e=d,T(b,function(b,c){M.set(b,c,e)});var f=new Date;f.setTime(f.getTime());e=e?";expires="+(new Date(f.getTime()+864E5*e)).toGMTString():"";d="object"===typeof d?V.encode(d):d;return c.cookie=b+"="+Ja(d)+e+";path=/"},remove:function(){T(arguments,function(b,c){M.set(c,"",-1)});return!0}},$json:{decode:b.JSON3?function(b){return V.isJSON(b)?P.parse(U.trim(b)):!1}:function(b){return V.isJSON(b)?(new Function("return "+U.trim(b)))():!1},encode:b.JSON3?
function(b){return P.stringify(b)}:function(b){return"{"+function(b){var c=[],d,e,f,g;for(d in b){f=b[d];e=typeof f;if("undefined"===e)return;if("function"!==e){switch(e){case "object":g=null===f?f:f.getDay?'"'+(1E3-10*~f.getUTCMonth()+f.toUTCString()+1E3+f/1).replace(/1(..).*?(\d\d)\D+(\d+).(\S+).*(...)/,"$3-$1-$2T$4.$5Z")+'"':f.length?"["+function(){var b=[];T(f,function(c,d){b.push("string"===typeof d?'"'+U.slashes(d)+'"':d)});return b.join(",")}()+"]":V.encode(f);break;case "number":g=isFinite(f)?
f:null;break;case "boolean":case "null":g=f;break;case "string":g='"'+U.slashes(f)+'"'}c.push('"'+d+'":'+g)}}return c.join(",")}(b)+"}"},isJSON:function(b){return"string"===typeof b&&""!==U.trim(b)?E.test(b.replace(A,"@").replace(z,"]").replace(u,"")):!1}},$ajax:function(b,c){"object"===typeof b&&(c=b,b=d);c=c||{};var e=new XMLHttpRequest;b=b||c.url;var f=[],g;c.data&&T(c.data,function(b,c){f.push(R(b,c))});g=f.join("&").replace(/%20/g,"+");if("GET"===c.type)e.open("GET",b+(s.test(b)?"&":"?")+g,!0),
g=null;else{try{e.withCredentials=!0}catch(h){}e.open(c.type||"POST",b,!0)}e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");c.header&&T(c.header,function(b,c){e.setRequestHeader(b,c)});e.send(g);e.onreadystatechange=function(){4===e.readyState&&(200===e.status&&c.success?(g=e.responseText,c.success(""!==g&&V.isJSON(g)?V.decode(g):g)):c.error&&c.error(e.status))}},$require:function(b,d){var f=[],g;T(b,function(b,h){F[h]||(F[h]=!0,f.push(h),g=/\.css[^\.]*$/ig.test(h)?
Da("link",{type:"text/css",rel:"stylesheet",href:h}):Da("script",{type:"text/javascript",async:!0,src:h}),g.onload=g.onreadystatechange=function(b){if("load"===b.type||/loaded|complete/.test(g.readyState))g.onload=g.onreadystatechange=null,f.splice(f.indexOf(h),1),0===f.length&&d&&d()},$(c.head||C(c,"head")[0]||e,g))})},$template:function(b,c){var d=G[b];d||(d="var s='';s+='"+b.replace(/[\r\t\n]/g," ").split("'").join("\\'").replace(/\{\{#([\w]*)\}\}(.*)\{\{\/(\1)\}\}/ig,function(b,c,d){return"';var i=0,l=data."+
c+".length,d=data."+c+";for(;i<l;i++){s+='"+d.replace(/\{\{(\.|this)\}\}/g,"'+d[i]+'").replace(/\{\{([\w]*)\}\}/g,"'+d[i].$1+'")+"'}s+='"}).replace(/\{\{(.+?)\}\}/g,"'+data.$1+'")+"';return s;",G[b]=d);return c?(new Function("data",d))(c):new Function("data",d)},$url:function(b){return encodeURIComponent(b)},$rand:function(b,c){return Math.floor(Math.random()*(c-b+1)+b)},$browser:function(){for(var b=navigator.userAgent.toLowerCase(),c={},d="msie firefox opera webkit iPad iPhone android".split(" "),
e=d.length,f=6;e--;)c[d[e]]=-1<b.indexOf(d[e].toLowerCase());for(;12>f;f++)c["msie"+f]=-1<b.indexOf("msie "+f);c.is=function(c){return(new RegExp(c,"ig")).test(b)};return c}()};ea.$ready(function(){c.querySelectorAll||(ea.Qselector=$(c.body,Da("style")));b.localStorage||(ea.storage=$(c.body,Da("link",{style:{behavior:"url(#default#userData)"}})))});return ea}(n,s),h=A.$,T=A.$each,ac=A.$dom,C=A.$tag,m=A.$class,Y=A.$select,Da=A.$new,U=A.$string,D=A.$attr,kb=A.$data,Z=A.$storage,p=A.$event,x=A.$css,
O=A.$style,$=A.$append,ba=A.$remove,lb=A.$empty,H=A.$html,jb=A.$text,y=A.$className,r=A.$hide,v=A.$show,ib=A.$animate,M=A.$cookie,V=A.$json,ya=A.$ajax,Ja=A.$url,E=new (function(){var b=function(b){b=b||{};this.ns=b.ns||"__sbz";this.data=Z.get(this.ns)||{};var d=this;q.each(d.data,function(b,c){b.e&&+new Date>b.e&&(delete d.data[c],Z.set(d.ns,d.data))})};b.prototype={set:function(b,d,e){this.data[b]={v:d,e:e?+new Date+e:0};Z.set(this.ns,this.data)},get:function(b){var d=this.data[b]||"";return d?d.e&&
+new Date>d.e?(delete this.data[b],Z.set(this.ns,this.data),null):d.v:null},remove:function(b){delete this.data[b];Z.set(this.ns,this.data)},clear:function(){this.data={};Z.set(this.ns,this.data)}};return b}());Z.remove("sbz_triggers_state");Z.remove("sbz_notify_agent_busy");Z.remove("sbz_time_last_message");Z.remove("sbz_new_message");Z.remove("sbz_sound");Z.remove("sbz_bubble");Z.remove("sbz_time_start");var bc=function(){var b={},c=function(){};c.prototype.addEventListener=function(c,d){this._listeners||
(this._listeners={});c in this._listeners||(this._listeners[c]=[]);var e=this._listeners[c];-1===b.arrIndexOf(e,d)&&e.push(d)};c.prototype.removeEventListener=function(c,d){if(this._listeners&&c in this._listeners){var e=this._listeners[c],f=b.arrIndexOf(e,d);-1!==f&&(1<e.length?this._listeners[c]=e.slice(0,f).concat(e.slice(f+1)):delete this._listeners[c])}};c.prototype.dispatchEvent=function(b){var c=b.type,d=Array.prototype.slice.call(arguments,0);this["on"+c]&&this["on"+c].apply(this,d);if(this._listeners&&
c in this._listeners)for(var e=0;e<this._listeners[c].length;e++)this._listeners[c][e].apply(this,d)};var d=function(b,c){this.type=b;if("undefined"!==typeof c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d])};d.prototype.toString=function(){var b=[],c;for(c in this)if(this.hasOwnProperty(c)){var d=this[c];"function"===typeof d&&(d="[function]");b.push(c+"="+d)}return"SimpleEvent("+b.join(", ")+")"};var e=function(b){this._events=b||[];this._listeners={}};e.prototype.emit=function(b){this._verifyType(b);
if(!this._nuked){var c=Array.prototype.slice.call(arguments,1);this["on"+b]&&this["on"+b].apply(this,c);if(b in this._listeners)for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].apply(this,c)}};e.prototype.on=function(b,c){this._verifyType(b);this._nuked||(b in this._listeners||(this._listeners[b]=[]),this._listeners[b].push(c))};e.prototype._verifyType=function(c){-1===b.arrIndexOf(this._events,c)&&b.log("Event "+P.stringify(c)+" not listed "+P.stringify(this._events)+" in "+this)};
e.prototype.nuke=function(){this._nuked=!0;for(var b=0;b<this._events.length;b++)delete this[this._events[b]];this._listeners={}};b.random_string=function(b,c){c=c||37;var d,e=[];for(d=0;d<b;d++)e.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*c),1));return e.join("")};b.random_number=function(b){return Math.floor(Math.random()*b)};b.random_number_string=function(c){var d=(""+(c-1)).length;return(Array(d+1).join("0")+b.random_number(c)).slice(-d)};b.getOrigin=function(b){return(b+
"/").split("/").slice(0,3).join("/")};b.isSameOriginUrl=function(b,c){c||(c=n.location.href);return b.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")};b.getParentDomain=function(b){return/^[0-9.]*$/.test(b)||/^\[/.test(b)||!/[.]/.test(b)?b:b.split(".").slice(1).join(".")};b.objectExtend=function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b};b.polluteGlobalNamespace=function(){"_jp"in n||(n._jp={})};b.closeFrame=function(b,c){return"c"+P.stringify([b,c])};b.userSetCode=
function(b){return 1E3===b||3E3<=b&&4999>=b};b.countRTO=function(b){return 100<b?3*b:b+200};b.log=function(){n.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)};b.bind=function(b,c){return b.bind?b.bind(c):function(){return b.apply(c,arguments)}};b.flatUrl=function(b){return-1===b.indexOf("?")&&-1===b.indexOf("#")};b.amendUrl=function(c){var d=s.location;if(!c)throw Error("Wrong url for SockSBZ");if(!b.flatUrl(c))throw Error("Only basic urls are supported in SockSBZ");
0===c.indexOf("//")&&(c=d.protocol+c);0===c.indexOf("/")&&(c=d.protocol+"//"+d.host+c);return c=c.replace(/[/]+$/,"")};b.arrIndexOf=function(b,c){for(var d=0;d<b.length;d++)if(b[d]===c)return d;return-1};b.arrSkip=function(c,d){var e=b.arrIndexOf(c,d);return-1===e?c.slice():c.slice(0,e).concat(c.slice(e+1))};b.isArray=Array.isArray||function(b){return 0<={}.toString.call(b).indexOf("Array")};b.delay=function(b,c){"function"===typeof b&&(c=b,b=0);return setTimeout(c,b)};var f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g={"\x00":"\\u0000","\u0001":"\\u0001","\u0002":"\\u0002","\u0003":"\\u0003","\u0004":"\\u0004","\u0005":"\\u0005","\u0006":"\\u0006","\u0007":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\x0B":"\\u000b","\f":"\\f","\r":"\\r","\u000e":"\\u000e","\u000f":"\\u000f","\u0010":"\\u0010","\u0011":"\\u0011","\u0012":"\\u0012","\u0013":"\\u0013","\u0014":"\\u0014","\u0015":"\\u0015","\u0016":"\\u0016","\u0017":"\\u0017","\u0018":"\\u0018","\u0019":"\\u0019","\u001a":"\\u001a","\u001b":"\\u001b","\u001c":"\\u001c",
"\u001d":"\\u001d","\u001e":"\\u001e","\u001f":"\\u001f",'"':'\\"',"\\":"\\\\","\u007f":"\\u007f","\u0080":"\\u0080","\u0081":"\\u0081","\u0082":"\\u0082","\u0083":"\\u0083","\u0084":"\\u0084","\u0085":"\\u0085","\u0086":"\\u0086","\u0087":"\\u0087","\u0088":"\\u0088","\u0089":"\\u0089","\u008a":"\\u008a","\u008b":"\\u008b","\u008c":"\\u008c","\u008d":"\\u008d","\u008e":"\\u008e","\u008f":"\\u008f","\u0090":"\\u0090","\u0091":"\\u0091","\u0092":"\\u0092","\u0093":"\\u0093","\u0094":"\\u0094","\u0095":"\\u0095",
"\u0096":"\\u0096","\u0097":"\\u0097","\u0098":"\\u0098","\u0099":"\\u0099","\u009a":"\\u009a","\u009b":"\\u009b","\u009c":"\\u009c","\u009d":"\\u009d","\u009e":"\\u009e","\u009f":"\\u009f","\u00ad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b",
"\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063","\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5",
"\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd","\ufffe":"\\ufffe","\uffff":"\\uffff"},h=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
k,l=P&&P.stringify||function(b){f.lastIndex=0;f.test(b)&&(b=b.replace(f,function(b){return g[b]}));return'"'+b+'"'},m=function(b){var c,d={},e=[];for(c=0;65536>c;c++)e.push(String.fromCharCode(c));b.lastIndex=0;e.join("").replace(b,function(b){d[b]="\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4);return""});b.lastIndex=0;return d};b.quote=function(b){b=l(b);h.lastIndex=0;if(!h.test(b))return b;k||(k=m(h));return b.replace(h,function(b){return k[b]})};var q="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");
b.probeProtocols=function(){for(var b={},c=0;c<q.length;c++){var d=q[c];b[d]=u[d]&&u[d].enabled()}return b};b.detectProtocols=function(b,c,d){var e={},f=[];c||(c=q);for(var g=0;g<c.length;g++){var h=c[g];e[h]=b[h]}var k=function(b){var c=b.shift();e[c]?f.push(c):0<b.length&&k(b)};!1!==d.websocket&&k(["websocket"]);e["xhr-streaming"]&&!d.null_origin?f.push("xhr-streaming"):!e["xdr-streaming"]||d.cookie_needed||d.null_origin?k(["iframe-eventsource","iframe-htmlfile"]):f.push("xdr-streaming");e["xhr-polling"]&&
!d.null_origin?f.push("xhr-polling"):!e["xdr-polling"]||d.cookie_needed||d.null_origin?k(["iframe-xhr-polling","jsonp-polling"]):f.push("xdr-polling");return f};b.createHook=function(){var c="a"+b.random_string(8);if(!("_sockjs_global"in n)){var d={};n._sockjs_global=function(b){b in d||(d[b]={id:b,del:function(){delete d[b]}});return d[b]}}return n._sockjs_global(c)};b.attachMessage=function(c){b.attachEvent("message",c)};b.attachEvent=function(b,c){"undefined"!==typeof n.addEventListener?n.addEventListener(b,
c,!1):(s.attachEvent("on"+b,c),n.attachEvent("on"+b,c))};b.detachMessage=function(c){b.detachEvent("message",c)};b.detachEvent=function(b,c){"undefined"!==typeof n.addEventListener?n.removeEventListener(b,c,!1):(s.detachEvent("on"+b,c),n.detachEvent("on"+b,c))};var p={},t=!1,v=function(){for(var b in p)p[b](),delete p[b]};b.attachEvent("unload",function(){t||(t=!0,v())});b.unload_add=function(c){var d=b.random_string(8);p[d]=c;t&&b.delay(v);return d};b.unload_del=function(b){b in p&&delete p[b]};
b.createIframe=function(c,d){var e=s.createElement("iframe"),f,g,h=function(){clearTimeout(f);try{e.onload=null}catch(b){}e.onerror=null},k=function(){e&&(h(),setTimeout(function(){e&&e.parentNode.removeChild(e);e=null},0),b.unload_del(g))},l=function(b){e&&(k(),d(b))};e.src=c;e.style.display="none";e.style.position="absolute";e.onerror=function(){l("onerror")};e.onload=function(){clearTimeout(f);f=setTimeout(function(){l("onload timeout")},2E3)};s.body.appendChild(e);f=setTimeout(function(){l("timeout")},
15E3);g=b.unload_add(k);return{post:function(b,c){try{e&&e.contentWindow&&e.contentWindow.postMessage(b,c)}catch(d){}},cleanup:k,loaded:h}};b.createHtmlfile=function(c,d){var e=new ActiveXObject("htmlfile"),f,g,h,k=function(){clearTimeout(f)},l=function(){e&&(k(),b.unload_del(g),h.parentNode.removeChild(h),h=e=null,CollectGarbage())};e.open();e.write('<html><script>document.domain="'+s.domain+'";\x3c/script></html>');e.close();e.parentWindow._jp=n._jp;var S=e.createElement("div");e.body.appendChild(S);
h=e.createElement("iframe");S.appendChild(h);h.src=c;f=setTimeout(function(){e&&(l(),d("timeout"))},15E3);g=b.unload_add(l);return{post:function(b,c){try{h&&h.contentWindow&&h.contentWindow.postMessage(b,c)}catch(d){}},cleanup:l,loaded:k}};var z=function(){};z.prototype=new e(["chunk","finish"]);z.prototype._start=function(c,d,e,f){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new n.ActiveXObject("Microsoft.XMLHTTP")}catch(k){}if(n.ActiveXObject||n.XDomainRequest)d+=(-1===
d.indexOf("?")?"?":"&")+"t="+ +new Date;g.unload_ref=b.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(c,d,!0)}catch(l){g.emit("finish",0,"");g._cleanup();return}f&&f.no_credentials||(g.xhr.withCredentials="true");if(f&&f.headers)for(var S in f.headers)g.xhr.setRequestHeader(S,f.headers[S]);g.xhr.onreadystatechange=function(){if(g.xhr){var b=g.xhr;switch(b.readyState){case 3:try{var c=b.status,d=b.responseText}catch(e){}1223===c&&(c=204);d&&0<d.length&&g.emit("chunk",c,d);break;case 4:c=b.status,
1223===c&&(c=204),g.emit("finish",c,b.responseText),g._cleanup(!1)}}};g.xhr.send(e)};z.prototype._cleanup=function(c){if(this.xhr){b.unload_del(this.unload_ref);this.xhr.onreadystatechange=function(){};if(c)try{this.xhr.abort()}catch(d){}this.unload_ref=this.xhr=null}};z.prototype.close=function(){this.nuke();this._cleanup(!0)};(b.XHRCorsObject=function(){var c=this,d=arguments;b.delay(function(){c._start.apply(c,d)})}).prototype=new z;(b.XHRLocalObject=function(c,d,e){var f=this;b.delay(function(){f._start(c,
d,e,{no_credentials:!0})})}).prototype=new z;z=b.XDRObject=function(c,d,e){var f=this;b.delay(function(){f._start(c,d,e)})};z.prototype=new e(["chunk","finish"]);z.prototype._start=function(c,d,e){var f=this,g=new XDomainRequest;d+=(-1===d.indexOf("?")?"?":"&")+"t="+ +new Date;var h=g.ontimeout=g.onerror=function(){f.emit("finish",0,"");f._cleanup(!1)};g.onprogress=function(){f.emit("chunk",200,g.responseText)};g.onload=function(){f.emit("finish",200,g.responseText);f._cleanup(!1)};f.xdr=g;f.unload_ref=
b.unload_add(function(){f._cleanup(!0)});try{f.xdr.open(c,d),f.xdr.send(e)}catch(k){h()}};z.prototype._cleanup=function(c){if(this.xdr){b.unload_del(this.unload_ref);this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(c)try{this.xdr.abort()}catch(d){}this.unload_ref=this.xdr=null}};z.prototype.close=function(){this.nuke();this._cleanup(!0)};b.isXHRCorsCapable=function(){return n.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:n.XDomainRequest&&s.domain?2:w.enabled()?
3:4};var u=function(c,d,e){if(this===n)return new u(c,d,e);var f=this,g;f._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0};e&&b.objectExtend(f._options,e);f._base_url=b.amendUrl(c);f._server=f._options.server||b.random_number_string(1E3);f._options.protocols_whitelist&&f._options.protocols_whitelist.length?g=f._options.protocols_whitelist:(g="string"===typeof d&&0<d.length?[d]:b.isArray(d)?d:null)&&f._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockSBZ constructor.');
f._protocols=[];f.protocol=null;f.readyState=u.CONNECTING;f._ir=T(f._base_url);f._ir.onfinish=function(c,d){f._ir=null;c?(f._options.info&&(c=b.objectExtend(c,f._options.info)),f._options.rtt&&(d=f._options.rtt),f._applyInfo(c,d,g),f._didClose()):f._didClose(1002,"Can't connect to server",!0)}};u.prototype=new c;u.version="0.3.4";u.CONNECTING=0;u.OPEN=1;u.CLOSING=2;u.CLOSED=3;u.prototype._debug=function(){this._options.debug&&b.log.apply(b,arguments)};u.prototype._dispatchOpen=function(){this.readyState===
u.CONNECTING?(this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null),this.readyState=u.OPEN,this.dispatchEvent(new d("open"))):this._didClose(1006,"Server lost session")};u.prototype._dispatchMessage=function(b){this.readyState===u.OPEN&&this.dispatchEvent(new d("message",{data:b}))};u.prototype._dispatchHeartbeat=function(b){this.readyState===u.OPEN&&this.dispatchEvent(new d("heartbeat",{}))};u.prototype._didClose=function(c,e,f){var g=this;if(g.readyState!==u.CONNECTING&&
g.readyState!==u.OPEN&&g.readyState!==u.CLOSING)throw Error("INVALID_STATE_ERR");g._ir&&(g._ir.nuke(),g._ir=null);g._transport&&(g._transport.doCleanup(),g._transport=null);var h=new d("close",{code:c,reason:e,wasClean:b.userSetCode(c)});if(!b.userSetCode(c)&&g.readyState===u.CONNECTING&&!f){if(g._try_next_protocol(h))return;h=new d("close",{code:2E3,reason:"All transports failed",wasClean:!1,last_event:h})}g.readyState=u.CLOSED;b.delay(function(){g.dispatchEvent(h)})};u.prototype._didMessage=function(b){switch(b.slice(0,
1)){case "o":this._dispatchOpen();break;case "a":b=P.parse(b.slice(1)||"[]");for(var c=0;c<b.length;c++)this._dispatchMessage(b[c]);break;case "m":b=P.parse(b.slice(1)||"null");this._dispatchMessage(b);break;case "c":b=P.parse(b.slice(1)||"[]");this._didClose(b[0],b[1]);break;case "h":this._dispatchHeartbeat()}};u.prototype._try_next_protocol=function(c){var d=this;d.protocol&&(d._debug("Closed transport:",d.protocol,""+c),d.protocol=null);d._transport_tref&&(clearTimeout(d._transport_tref),d._transport_tref=
null);for(;;){c=d.protocol=d._protocols.shift();if(!c)return!1;if(u[c]&&!0===u[c].need_body&&(!s.body||"undefined"!==typeof s.readyState&&"complete"!==s.readyState))return d._protocols.unshift(c),d.protocol="waiting-for-load",b.attachEvent("load",function(){d._try_next_protocol()}),!0;if(u[c]&&u[c].enabled(d._options)){d._transport_tref=b.delay((d._options.rto||0)*(u[c].roundTrips||1)||5E3,function(){d.readyState===u.CONNECTING&&d._didClose(2007,"Transport timeouted")});var e=b.random_string(8),e=
d._base_url+"/"+d._server+"/"+e;d._debug("Opening transport:",c," url:"+e," RTO:"+d._options.rto);d._transport=new u[c](d,e,d._base_url);return!0}d._debug("Skipping transport:",c)}};u.prototype.close=function(c,d){if(c&&!b.userSetCode(c))throw Error("INVALID_ACCESS_ERR");if(this.readyState!==u.CONNECTING&&this.readyState!==u.OPEN)return!1;this.readyState=u.CLOSING;this._didClose(c||1E3,d||"Normal closure");return!0};u.prototype.send=function(c){if(this.readyState===u.CONNECTING)throw Error("INVALID_STATE_ERR");
this.readyState===u.OPEN&&this._transport.doSend(b.quote(""+c));return!0};u.prototype._applyInfo=function(c,d,e){this._options.info=c;this._options.rtt=d;this._options.rto=b.countRTO(d);this._options.info.null_origin=!s.domain;d=b.probeProtocols();this._protocols=b.detectProtocols(d,e,c)};z=u.websocket=function(c,d){var e=this,f=d+"/websocket",f="https"===f.slice(0,5)?"wss"+f.slice(5):"ws"+f.slice(4);e.ri=c;e.url=f;e.ws=new (n.WebSocket||n.MozWebSocket)(e.url);e.ws.onmessage=function(b){e.ri._didMessage(b.data)};
e.unload_ref=b.unload_add(function(){e.ws.close()});e.ws.onclose=function(){e.ri._didMessage(b.closeFrame(1006,"WebSocket connection broken"))}};z.prototype.doSend=function(b){this.ws.send("["+b+"]")};z.prototype.doCleanup=function(){var c=this.ws;c&&(c.onmessage=c.onclose=null,c.close(),b.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)};z.enabled=function(){return!(!n.WebSocket&&!n.MozWebSocket)};z.roundTrips=2;var r=function(){};r.prototype.send_constructor=function(b){this.send_buffer=
[];this.sender=b};r.prototype.doSend=function(b){this.send_buffer.push(b);this.send_stop||this.send_schedule()};r.prototype.send_schedule_wait=function(){var c=this,d;c.send_stop=function(){c.send_stop=null;clearTimeout(d)};d=b.delay(25,function(){c.send_stop=null;c.send_schedule()})};r.prototype.send_schedule=function(){var b=this;if(0<b.send_buffer.length){var c="["+b.send_buffer.join(",")+"]";b.send_stop=b.sender(b.trans_url,c,function(c,d){b.send_stop=null;!1===c?b.ri._didClose(1006,"Sending error "+
d):b.send_schedule_wait()});b.send_buffer=[]}};r.prototype.send_destructor=function(){this._send_stop&&this._send_stop();this._send_stop=null};var x=function(c,d,e){if(!("_send_form"in this)){var f=this._send_form=s.createElement("form"),g=this._send_area=s.createElement("textarea");g.name="d";f.style.display="none";f.style.position="absolute";f.method="POST";f.enctype="application/x-www-form-urlencoded";f.acceptCharset="UTF-8";f.appendChild(g);s.body.appendChild(f)}var f=this._send_form,g=this._send_area,
h="a"+b.random_string(8);f.target=h;f.action=c+"/jsonp_send?i="+h;var k;try{k=s.createElement('<iframe name="'+h+'">')}catch(l){k=s.createElement("iframe"),k.name=h}k.id=h;f.appendChild(k);k.style.display="none";try{g.value=d}catch(S){b.log("Your browser is seriously broken. Go home! "+S.message)}f.submit();var m=function(c){k.onerror&&(k.onreadystatechange=k.onerror=k.onload=null,b.delay(500,function(){k.parentNode.removeChild(k);k=null}),g.value="",e(!0))};k.onerror=k.onload=m;k.onreadystatechange=
function(b){"complete"==k.readyState&&m()};return m},y=function(b){return function(c,d,e){(new b("POST",c+"/xhr_send",d)).onfinish=function(b,c){e(200===b||204===b,"http status "+b)};return function(b){e(!1,b)}}},C=function(c,d){var e,f=s.createElement("script"),g,h=function(b){g&&(g.parentNode.removeChild(g),g=null);f&&(clearTimeout(e),f.parentNode.removeChild(f),f=f.onreadystatechange=f.onerror=f.onload=f.onclick=null,d(b),d=null)},k=!1,l=null;f.id="a"+b.random_string(8);f.src=c;f.type="text/javascript";
f.charset="UTF-8";f.onerror=function(c){l||(l=setTimeout(function(){k||h(b.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1E3))};f.onload=function(c){h(b.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};f.onreadystatechange=function(c){if(/loaded|closed/.test(f.readyState)){if(f&&f.htmlFor&&f.onclick){k=!0;try{f.onclick()}catch(d){}}f&&h(b.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if("undefined"===typeof f.async&&s.attachEvent)if(/opera/i.test(navigator.userAgent))g=
s.createElement("script"),g.text="try{var a = document.getElementById('"+f.id+"'); if(a)a.onerror();}catch(x){};",f.async=g.async=!1;else{try{f.htmlFor=f.id,f.event="onclick"}catch(S){}f.async=!0}"undefined"!==typeof f.async&&(f.async=!0);e=setTimeout(function(){h(b.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35E3);var m=s.getElementsByTagName("head")[0];m.insertBefore(f,m.firstChild);g&&m.insertBefore(g,m.firstChild);return h},z=u["jsonp-polling"]=function(c,d){b.polluteGlobalNamespace();
this.ri=c;this.trans_url=d;this.send_constructor(x);this._schedule_recv()};z.prototype=new r;z.prototype._schedule_recv=function(){var b=this;b._recv_stop=E(b.trans_url+"/jsonp",C,function(c){b._recv_stop=null;c&&(b._is_closing||b.ri._didMessage(c));b._is_closing||b._schedule_recv()})};z.enabled=function(){return!0};z.need_body=!0;z.prototype.doCleanup=function(){this._is_closing=!0;this._recv_stop&&this._recv_stop();this.ri=this._recv_stop=null;this.send_destructor()};var E=function(c,d,e){var f=
"a"+b.random_string(6);c=c+"?c="+escape("_jp."+f);var g=0;d=d(c,function(b){switch(g){case 0:delete n._jp[f];e(b);break;case 1:e(b);g=2;break;case 2:delete n._jp[f]}});n._jp[f]=d;return function(){n._jp[f]&&(g=1,n._jp[f](b.closeFrame(1E3,"JSONP user aborted read")))}},z=function(){};z.prototype=new r;z.prototype.run=function(b,c,d,e,f){this.ri=b;this.trans_url=c;this.send_constructor(y(f));this.poll=new O(b,e,c+d,f)};z.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};
var A=u["xhr-streaming"]=function(c,d){this.run(c,d,"/xhr_streaming",M,b.XHRCorsObject)};A.prototype=new z;A.enabled=function(){return n.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};A.roundTrips=2;A.need_body=!0;r=u["xdr-streaming"]=function(c,d){this.run(c,d,"/xhr_streaming",M,b.XDRObject)};r.prototype=new z;r.enabled=function(){return!!n.XDomainRequest};r.roundTrips=2;var B=u["xhr-polling"]=function(c,d){this.run(c,d,"/xhr",M,b.XHRCorsObject)};B.prototype=
new z;B.enabled=A.enabled;B.roundTrips=2;A=u["xdr-polling"]=function(c,d){this.run(c,d,"/xhr",M,b.XDRObject)};A.prototype=new z;A.enabled=r.enabled;A.roundTrips=2;var w=function(){};w.prototype.i_constructor=function(c,d,e){var f=this;f.ri=c;f.origin=b.getOrigin(e);f.base_url=e;f.trans_url=d;c=e+"/iframe.html";f.ri._options.devel&&(c+="?t="+ +new Date);f.window_id=b.random_string(8);c+="#"+f.window_id;f.iframeObj=b.createIframe(c,function(b){f.ri._didClose(1006,"Unable to load an iframe ("+b+")")});
f.onmessage_cb=b.bind(f.onmessage,f);b.attachMessage(f.onmessage_cb)};w.prototype.doCleanup=function(){if(this.iframeObj){b.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&this.postMessage("c")}catch(c){}this.iframeObj.cleanup();this.onmessage_cb=this.iframeObj=this.iframeObj=null}};w.prototype.onmessage=function(b){if(b.origin===this.origin){var c=b.data.slice(0,8),d=b.data.slice(8,9);b=b.data.slice(9);if(c===this.window_id)switch(d){case "s":this.iframeObj.loaded();this.postMessage("s",
P.stringify([u.version,this.protocol,this.trans_url,this.base_url]));break;case "t":this.ri._didMessage(b)}}};w.prototype.postMessage=function(b,c){this.iframeObj.post(this.window_id+b+(c||""),this.origin)};w.prototype.doSend=function(b){this.postMessage("m",b)};w.enabled=function(){var b=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"===typeof n.postMessage||"object"===typeof n.postMessage)&&!b};var F,G=function(c,d){parent!==n?parent.postMessage(F+
c+(d||""),"*"):b.log("Can't postMessage, no parent window.",c,d)},D=function(){};D.prototype._didClose=function(c,d){G("t",b.closeFrame(c,d))};D.prototype._didMessage=function(b){G("t",b)};D.prototype._doSend=function(b){this._transport.doSend(b)};D.prototype._doCleanup=function(){this._transport.doCleanup()};b.parent_origin=void 0;u.bootstrap_iframe=function(){var c;F=s.location.hash.slice(1);b.attachMessage(function(d){if(d.source===parent&&("undefined"===typeof b.parent_origin&&(b.parent_origin=
d.origin),d.origin===b.parent_origin)){var e=d.data.slice(0,8),f=d.data.slice(8,9);d=d.data.slice(9);if(e===F)switch(f){case "s":var g=P.parse(d),e=g[0],f=g[1];d=g[2];g=g[3];e!==u.version&&b.log('Incompatibile SockSBZ! Main site uses: "'+e+'", the iframe: "'+u.version+'".');if(!b.flatUrl(d)||!b.flatUrl(g)){b.log("Only basic urls are supported in SockSBZ");break}if(!b.isSameOriginUrl(d)||!b.isSameOriginUrl(g)){b.log("Can't connect to different domain from within an iframe. ("+P.stringify([n.location.href,
d,g])+")");break}c=new D;c._transport=new D[f](c,d,g);break;case "m":c._doSend(d);break;case "c":c&&c._doCleanup(),c=null}}});G("s")};var H=function(c,d){var e=this;b.delay(function(){e.doXhr(c,d)})};H.prototype=new e(["finish"]);H.prototype.doXhr=function(c,d){var e=this,f=(new Date).getTime(),g=new d("GET",c+"/info"),h=b.delay(8E3,function(){g.ontimeout()});g.onfinish=function(b,c){clearTimeout(h);h=null;if(200===b){var d=(new Date).getTime()-f,g=P.parse(c);"object"!==typeof g&&(g={});e.emit("finish",
g,d)}else e.emit("finish")};g.ontimeout=function(){g.close();e.emit("finish")}};var L=function(c){var d=this,e=function(){var b=new w;b.protocol="w-iframe-info-receiver";var e=function(c){"string"===typeof c&&"m"===c.substr(0,1)?(c=P.parse(c.substr(1)),d.emit("finish",c[0],c[1])):d.emit("finish");b.doCleanup();b=null};b.i_constructor({_options:{},_didClose:e,_didMessage:e},c,c)};s.body?e():b.attachEvent("load",e)};L.prototype=new e(["finish"]);var N=function(){var c=this;b.delay(function(){c.emit("finish",
{},2E3)})};N.prototype=new e(["finish"]);var T=function(c){if(b.isSameOriginUrl(c))return new H(c,b.XHRLocalObject);switch(b.isXHRCorsCapable()){case 1:return new H(c,b.XHRLocalObject);case 2:return new H(c,b.XDRObject);case 3:return new L(c);default:return new N}};(D["w-iframe-info-receiver"]=function(c,d,e){(new H(e,b.XHRLocalObject)).onfinish=function(b,d){c._didMessage("m"+P.stringify([b,d]));c._didClose()}}).prototype.doCleanup=function(){};e=u["iframe-eventsource"]=function(){this.protocol=
"w-iframe-eventsource";this.i_constructor.apply(this,arguments)};e.prototype=new w;e.enabled=function(){return"EventSource"in n&&w.enabled()};e.need_body=!0;e.roundTrips=3;(D["w-iframe-eventsource"]=function(c,d){this.run(c,d,"/eventsource",R,b.XHRLocalObject)}).prototype=new z;e=u["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling";this.i_constructor.apply(this,arguments)};e.prototype=new w;e.enabled=function(){return n.XMLHttpRequest&&w.enabled()};e.need_body=!0;e.roundTrips=3;
(D["w-iframe-xhr-polling"]=function(c,d){this.run(c,d,"/xhr",M,b.XHRLocalObject)}).prototype=new z;e=u["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile";this.i_constructor.apply(this,arguments)};e.prototype=new w;e.enabled=function(){return w.enabled()};e.need_body=!0;e.roundTrips=3;(D["w-iframe-htmlfile"]=function(c,d){this.run(c,d,"/htmlfile",U,b.XHRLocalObject)}).prototype=new z;var O=function(b,c,d,e){this.ri=b;this.Receiver=c;this.recv_url=d;this.AjaxObject=e;this._scheduleRecv()};
O.prototype._scheduleRecv=function(){var b=this,c=b.poll=new b.Receiver(b.recv_url,b.AjaxObject);c.onmessage=function(c){b.ri._didMessage(c.data)};c.onclose=function(d){b.poll=c=c.onmessage=c.onclose=null;b.poll_is_closing||("permanent"===d.reason?b.ri._didClose(1006,"Polling error ("+d.reason+")"):b._scheduleRecv())}};O.prototype.abort=function(){this.poll_is_closing=!0;this.poll&&this.poll.abort()};var R=function(c){var e=this,f=new EventSource(c);f.onmessage=function(b){e.dispatchEvent(new d("message",
{data:unescape(b.data)}))};e.es_close=f.onerror=function(c,g){var h=g?"user":2!==f.readyState?"network":"permanent";e.es_close=f.onmessage=f.onerror=null;f.close();f=null;b.delay(200,function(){e.dispatchEvent(new d("close",{reason:h}))})}};R.prototype=new c;R.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var Q,U=function(c){var e=this;b.polluteGlobalNamespace();e.id="a"+b.random_string(6,26);c+=(-1===c.indexOf("?")?"?":"&")+"c="+escape("_jp."+e.id);if(void 0===Q)if("ActiveXObject"in
n)try{Q=!!new ActiveXObject("htmlfile")}catch(f){}else Q=!1;var g=Q?b.createHtmlfile:b.createIframe,h;n._jp[e.id]={start:function(){h.loaded()},message:function(b){e.dispatchEvent(new d("message",{data:b}))},stop:function(){e.iframe_close({},"network")}};e.iframe_close=function(b,c){h.cleanup();e.iframe_close=h=null;delete n._jp[e.id];e.dispatchEvent(new d("close",{reason:c}))};h=g(c,function(b){e.iframe_close({},"permanent")})};U.prototype=new c;U.prototype.abort=function(){this.iframe_close&&this.iframe_close({},
"user")};var M=function(b,c){var e=this,f=0;e.xo=new c("POST",b,null);e.xo.onchunk=function(b,c){if(200===b)for(;;){var g=c.slice(f),h=g.indexOf("\n");if(-1===h)break;f+=h+1;g=g.slice(0,h);e.dispatchEvent(new d("message",{data:g}))}};e.xo.onfinish=function(b,c){e.xo.onchunk(b,c);e.xo=null;e.dispatchEvent(new d("close",{reason:200===b?"network":"permanent"}))}};M.prototype=new c;M.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new d("close",{reason:"user"})),this.xo=null)};
u.getUtils=function(){return b};u.getIframeTransport=function(){return w};return u}(),cc=function(){var b=function(b,d){this._events={};this._url=b||"//"+n.location.hostname;this._port=80;this._socket=null;this._namespace="";this.auto_reconnect=!0;this._options=d||{};this._delay=this.delay=500;this.connected=this.reconnecting=!1;this.timer={};this.moment={}};b.prototype.on=function(b,d,e){var f=d;e&&(f=function(){d.apply(e,arguments)});this._events[b]||(this._events[b]=[]);this._events[b].push(f)};
b.prototype.emit=function(b){this._socket.send(P.stringify(b))};b.prototype.connect=function(){function b(c){var d=c.data;if(c=e._events[c.type?c.type:c.name])for(var f="object"===typeof d&&null!==d?d:P.parse(d),d=0,g=c.length;d<g;++d){var h=c[d];"function"===typeof h&&function(b){setTimeout(function(){b(f)},0)}(h)}}if(this._socket){var d=this.auto_reconnect;this.disconnect();this.auto_reconnect=d}var d=new bc(this._url,null,this._options),e=this;d.onopen=function(){e.delay=e._delay;e.connected=!0;
e.reconnecting&&(e.reconnecting=!1,e.moment.disconnect=null,b({name:"reconnect",data:{}}));e.timer.reconnect&&(clearTimeout(e.timer.reconnect),e.timer.reconnect=null);b({name:"open",data:{}});b({name:"connect",data:{}})};d.onmessage=function(d){b(d)};d.onclose=function(){b({name:"close",data:{}});b({name:"disconnect",data:{}});e.connected=!1;e.moment.disconnect||(e.moment.disconnect=+new Date);if(e.auto_reconnect){var d=+new Date;6E4<d-e.moment.disconnect?(t("reconnect timeout in 60s"),e.reconnecting=
!1,e.moment.disconnect=null,clearTimeout(e.timer.reconnect),e.timer.reconnect=null,b({name:"reconnect_failed",data:{}})):(e.reconnecting=!0,t("cb reconnect after "+e.delay+"ms"),t("disconnected in "+(d-e.moment.disconnect)+"ms"),e.timer.reconnect=setTimeout(function(){e.delay=2E3<e.delay?4E3:2*e.delay;e.connect()},e.delay))}};this._socket=d};b.prototype.reconnect=function(){this.connected?t("socket is connected : ignore call reconnect"):(this.auto_reconnect=!0,this.connect())};b.prototype.disconnect=
function(){this.auto_reconnect=!1;this._socket&&(this._socket.close(),this._socket=null)};return b}(),G=function(b,c){g.socket_connected?aa.emit(c):Za.push({channel:b,data:c})},dc=function(){if(0<Za.length){var b=q.clone(Za);Za=[];q.each(b,function(b){aa.emit(b.data)})}},mb=function(){g.socket_connected&&aa.disconnect()};"undefined"!=typeof _sbz_sid&&g._sbz_is_new_window&&(g.sbz_sid=_sbz_sid);"undefined"!=typeof _sbz_vid&&g._sbz_is_new_window&&(g.sbz_vid=_sbz_vid);"undefined"!=typeof _sbz_agent&&
g._sbz_is_new_window_pc&&(g.sbz_agent=_sbz_agent);"undefined"!=typeof _sbz_wopen&&(g.wopen=_sbz_wopen);var nb="none",Hb=!1,Jb=function(){if("1"==M.get("__sbzbl"))return!1;var b=E.get("time_site")||w();E.set("time_site",b,18E5);E.set("time_page",w(),18E5);g.url_static=R("http://static.subiz.com/");g.url_socket="https://sock-ha.subiz.com/widget";g.url_sock_p=R("http://sock-p.subiz.com/");g.url_dashboard=R("http://css-dashboard.subiz.com/");g.url_css=R(g.url_dashboard+"widget/css/"+g.aid+"/subiz-widget-view.css");
g.url_new_window="https://m.widget.subiz.com/v1/widget/";b=Ca.detect()||"desktop";k._device=b;if(g._sbz_is_new_window&&"desktop"==k._device)return!1;"desktop"!=k._device&&(g.url_css=R(g.url_dashboard+"widget/css/"+g.aid+"/subiz-widget-mobile.css"));g.url_avatar=R(g.url_dashboard+"img/avatar-chat.png");var b=ha(),c=fa(),d=g.wopen;c&&(g._sbz_is_new_window||M.set("__sbzsid",c),g.sbz_sid=c);b&&c||E.set("is_init",1,1E4);g.url_base_data=g.url_sock_p+"a/"+g.aid+(b?"?vid="+b:"");g._sbz_is_new_window&&(g.url_base_data=
g.url_sock_p+"a/"+g.aid+(b?"?vid="+b:"?vid=")+(c?"&sid="+c:"")+(d?"&wopen="+d:""));g._sbz_is_new_window_pc&&(g.url_base_data=g.url_sock_p+"a/"+g.aid+"?vid="+(d?"&wopen="+d:""));ya(g.url_static+"views/widget.txt",{type:"GET",success:function(b){t("cb get template");try{k.html=P.parse(ec(b,"Harry")),k.html_ready=!0}catch(c){t("Error parse json data"),t(c),k.html={},k.html_ready=!1}},error:function(b){}});ya(g.url_css,{type:"GET",success:function(b){t("css ready");k.css=b.replace(/..\/..\/img\//g,g.url_dashboard+
"widget/img/");k.css_ready=!0},error:function(b){}});ya(g.url_base_data,{type:"GET",success:function(b){t("cb get base data");t(b);if(b&&b.status)if(b.is_deny)t("deny request"),M.set("__sbzbl","1"),X.base_ready&&X.base_ready.id&&clearTimeout(X.base_ready.id);else{t("build base widget");k.lang=b.widget.language.data;k.lang.online.title_compress||(k.lang.online.title_compress=k.lang.online.title,k.lang.offline.title_compress=k.lang.offline.title);var c=b.widget.survey,d=b.widget.offline_survey||{};
c.name&&c.name.status||(d.name={status:"active",is_require:1},d.email={status:"active",is_require:1},d.phone={status:d.phone||c.phone,is_require:1},d.department={status:c.department,is_require:1},c.name={status:"active",is_require:1},c.email={status:"active",is_require:1},c.phone={status:c.phone,is_require:1},c.question={status:c.question,is_require:1},c.department={status:c.department,is_require:1},b.widget.offline_survey=d);k.widget=b.widget;g.status_widget=b.status;g.status_account=b.status;g._status_account=
b._status;g.position=b.position||"right";b.widget.avatar&&(RegExp("^http(s)?://","g").test(b.widget.avatar)?g.url_avatar=R(b.widget.avatar):g.url_avatar=g.url_dashboard+b.widget.avatar);ia("init",{check:function(){return k.css_ready&&k.html_ready?!0:!1},success:function(){ia("dom",{check:function(){return s.body?!0:!1},success:fc})}})}else t("Error decode data")},error:function(b){}});ia("io",{check:function(){var b=ha(),c=fa();return k.base_ready&&b&&c?!0:!1},success:gc});ya(g.url_sock_p+"ev/init",
{data:{aid:g.aid,vid:b,sid:c,url:n.location.href,title:s.title,referer:s.referrer,__v:"2.1412231133"},success:function(b){b&&0<q.size(b)&&q.each(b,function(b){Ib(b)})},error:function(b){}});M.get("__sbzer")&&(Hb=!0)},hc=function(){var b=k.session,c=b.agents_rated||{},d=b.agent||b.last_agent||"";d&&!c[d]&&(c[d]="good",b.agents_rated=c,m(f,"rate-good",function(b){y.add(b,"rated")}),G("cev",{ev:"rate",value:"good",time:w()}))},ic=function(){var b=k.session,c=b.agents_rated||{},d=b.agent||b.last_agent||
"";d&&!c[d]&&(c[d]="bad",b.agents_rated=c,m(f,"rate-bad",function(b){y.add(b,"rated")}),G("cev",{ev:"rate",value:"bad",time:w()}))},jc=function(){var b=k.visitor,c=b.name||"",d=b.email||"",b=b.phone||"",e=h(l,"v_department_offline").value,f=h(l,"v_message_offline").value,m=!0,J=k.widget.offline_survey||{};"active"!=J.department.status||1!=J.department.is_require||e?(y.remove(h(l,"v_department_offline"),"form-error"),r(h(l,"error_department_offline"))):(m=!1,t("valid","not derpatment"),y.add(h(l,"v_department_offline"),
"form-error"),v(h(l,"error_department_offline")));f?y.remove(h(l,"v_message_offline"),"form-error"):(m=!1,t("valid","not message"),y.add(h(l,"v_message_offline"),"form-error"));t("valid offline",m);m?(c={ev:"message_offline",name:c,email:d,phone:b,department:e,message:f,url:n.location.href,time:w()},"offline"==g._status_account?(d=g.url_sock_p+"ev/message_offline",c.aid=g.aid,c.vid=ha(),c.sid=fa(),t("cev_data",c),ya(d,{data:c,success:function(b){t("success data send mail",b)},error:function(b){t("error data send mail",
b)}})):(t("cev_data away",c),G("cev",c)),Fa(0),za(1),h(l,"v_message_offline").value=""):N("offline")},kc=function(){var b=k.widget.offline_survey||{},c=h(l,"v_name_offline").value.trim(),d=h(l,"v_email_offline").value.trim(),e=h(l,"v_phone_offline").value.trim(),f=h(l,"v_department_offline_edit").value,m=h(l,"v_message_offline_edit").value.trim(),J=!0;"active"!=b.name.status||1!=b.name.is_require||c?(y.remove(h(l,"v_name_offline"),"form-error"),r(h(l,"error_name_offline"))):(J=!1,y.add(h(l,"v_name_offline"),
"form-error"),v(h(l,"error_name_offline")));"active"!=b.email.status||1!=b.email.is_require&&!d||Ka(d)?(y.remove(h(l,"v_email_offline"),"form-error"),r(h(l,"error_email_offline"))):(J=!1,y.add(h(l,"v_email_offline"),"form-error"),v(h(l,"error_email_offline")));"active"!=b.phone.status||1!=b.phone.is_require||e?(y.remove(h(l,"v_phone_offline"),"form-error"),r(h(l,"error_phone_offline"))):(J=!1,y.add(h(l,"v_phone_offline"),"form-error"),v(h(l,"error_phone_offline")));"active"!=b.department.status||
1!=b.department.is_require||f?(y.remove(h(l,"v_department_offline_edit"),"form-error"),r(h(l,"error_department_edit_offline"))):(J=!1,y.add(h(l,"v_department_offline_edit"),"form-error"),v(h(l,"error_department_edit_offline")));m?y.remove(h(l,"v_message_offline_edit"),"form-error"):(J=!1,y.add(h(l,"v_message_offline_edit"),"form-error"));t("valid offline edit",J);J?(b={ev:"message_offline",name:c,email:d,phone:e,department:f,message:m,url:n.location.href,time:w()},"offline"==g._status_account?(f=
g.url_sock_p+"ev/message_offline",b.aid=g.aid,b.vid=ha(),b.sid=fa(),t("cev_data",b),ya(f,{data:b,success:function(b){t("success data send mail",b)},error:function(b){t("error data send mail",b)}})):(t("cev_data away",b),G("cev",b)),L("name",c),L("email",d),L("phone",e),La(0),za(1),h(l,"v_message_offline_edit").value=""):N("offline")},lc=function(){var b=k.widget.survey,c=h(f,"v_department_survey").value,d=h(f,"v_name_survey").value.trim(),e=h(f,"v_email_survey").value.trim(),g=h(f,"v_phone_survey").value.trim(),
l=h(f,"v_question_survey").value.trim(),J=!0;"active"!=b.department.status||1!=b.department.is_require||c?(y.remove(h(f,"v_department_survey"),"form-error"),r(h(f,"error_department_survey"))):(J=!1,y.add(h(f,"v_department_survey"),"form-error"),v(h(f,"error_department_survey")));"active"!=b.name.status||1!=b.name.is_require||d?(y.remove(h(f,"v_name_survey"),"form-error"),r(h(f,"error_name_survey"))):(J=!1,y.add(h(f,"v_name_survey"),"form-error"),v(h(f,"error_name_survey")));"active"!=b.email.status||
1!=b.email.is_require&&!e||Ka(e)?(y.remove(h(f,"v_email_survey"),"form-error"),r(h(f,"error_email_survey"))):(J=!1,y.add(h(f,"v_email_survey"),"form-error"),v(h(f,"error_email_survey")));"active"!=b.phone.status||1!=b.phone.is_require||g?(y.remove(h(f,"v_phone_survey"),"form-error"),r(h(f,"error_phone_survey"))):(J=!1,y.add(h(f,"v_phone_survey"),"form-error"),v(h(f,"error_phone_survey")));"active"==b.question.status&&1==b.question.is_require&&l&&m(f,"type_message",function(b){C(b,"textarea",function(b){b.value=
l})});J?(b={ev:"survey",department:c||"",name:d||"",email:e||"",phone:g||"",time:w()},G("cev",b),b.department&&(k.session.department=c),b.phone&&L("phone",g),b.name&&L("name",d),b.email&&L("email",e),na(0),ja(1)):N("online")},mc=function(){var b=h(f,"v_name_contact").value,c=h(f,"v_email_contact").value,d=!0;b?y.remove(h(f,"v_name_contact"),"form-error"):(d=!1,y.add(h(f,"v_name_contact"),"form-error"));Ka(c)?y.remove(h(f,"v_email_contact"),"form-error"):(d=!1,y.add(h(f,"v_email_contact"),"form-error"));
d&&(d={ev:"edit_contact",name:b,email:c,time:w()},G("cev",d),L("name",b),L("email",c),Ma(0),Na(1))},nc=function(){t("save email transcript");var b=h(f,"v_email_transcript").value;if(Ka(b)){y.remove(h(f,"v_email_transcript"),"form-error");var c={ev:"email_transcript",email:b,time:w()};G("cev",c);L("email",b);oa(0)}else y.add(h(f,"v_email_transcript"),"form-error")},oc=function(b){var c=k.session;if(13===b.which){b.preventDefault();var d="";m(f,"type_message",function(b){C(b,"textarea",function(b){d=
b.value})});d=U.trim(d);t(d);d?"offline"!=g.status_account&&(Aa("",q.escape(d)),Oa(0),G("cev",{ev:"chat",message:d,url:n.location.href,time:w()}),m(f,"type_message",function(b){C(b,"textarea",function(b){b.value=""})}),c.is_typing=!1,c.agent&&ab("SUBIZ Chat","Visitor chat",c.agent),q.isEmpty(k.triggers)||bb("chat_message"),c.agent||ob(g.waiting_time),E.set("time_message",w(),3E5)):m(f,"type_message",function(b){C(b,"textarea",function(b){b.value=""})})}else c.is_typing||(c.is_typing=!0,b={ev:"chatstates",
state:"composing",time:w()},G("cev",b))},ob=function(b){F.agent_busy&&(clearTimeout(F.agent_busy),F.agent_busy=null);E.get("agent_busy")||(F.agent_busy=setTimeout(function(){!k.session.agent&&k.lang.other.agent_busy&&(ua(k.lang.other.agent_busy),E.set("agent_busy","1",3E5))},1E3*b))},cb=function(){var b=0;m(f,"notice_new_message",function(c){b=H(c)});b=parseInt(b,10);return b=0<b?b:0},pc=function(){"desktop"!=k._device&&g._sbz_is_new_window&&("online"==g.status_widget?Ba():Ga());if("desktop"==k._device)if(g.is_expand)"online"==
g.status_widget?pb():qb();else{var b=k.session;b.is_expand&&1==b.is_expand&&(g.is_expand=1,"online"==g.status_widget?Ba():Ga())}if(b=E.get("trigger_result"))t("last trigger result :",b),q.isObject(b)&&(xa=b,q.each(k.triggers,function(b){if(xa[b.id]){var c=xa[b.id];b.is_check=c.is_check;b.is_match=c.is_match}else b.is_check=0,b.is_match=0}));if(b=E.get("new_message"))E.remove("new_message"),Pa(b),N("online");b=E.get("sound");if("on"==b||"off"==b)E.remove("sound"),k.session.sound=b,rb(b);var b=E.get("time_message"),
b=parseInt(b,10),c=E.get("agent_busy");0<b&&!c&&(b=w()-b,c=g.waiting_time-b,!k.session.agent&&-45<c&&(b>g.waiting_time?ob(0):0<b&&ob(c)));k.session_ready=!0},Qa=function(){F.presence&&(clearTimeout(F.presence),F.presence=null);g.socket_connected&&G("cev",{ev:"presence_status"});var b=w(),c=E.get("time_page")||w(),b=b-c;t("time_on_page :",b);F.presence=setTimeout(function(){Qa()},900<b?3E5:6E4)},bb=function(b,c){t("trigger event :",b,c);t("----------------------------------");var d=k.session,e=k.visitor_session,
f=k.visitor;q.find(k.triggers,function(g){if(g.data.event!=b||c&&g.id!=c)return!1;if(g.is_match&&g.fire_once)return t("ignore matched trigger :",g.id),!1;var h="trigger_"+g.id;F[h]&&clearTimeout(F[h]);t("check trigger :",g);var k=q.first(g.data.condition),l=q.rest(g.data.condition),m=0,p=0;q.each(l,function(b){var c=0,g="",h=b[2];if("@hour_of_day"==b[1])g=(new Date).getHours(),h=parseInt(h,10);else if("@day_of_week"==b[1])g=(new Date).getDay(),h=parseInt(h,10);else if("@visitor_time_on_site"==b[1]){var g=
0,k=E.get("time_site"),k=parseInt(k,10);k||(k=+new Date(e.time.start),k=Math.floor(k/1E3));k&&(g=w()-k,g=parseInt(Math.round(g),10));h=parseInt(h,10);h>g&&(c=+new Date+1E3*(h-g))}else"@visitor_ip"==b[1]?g=e.ip:"@visitor_city"==b[1]?(g=d.geo.city,g=g.toLowerCase(),h=h.toLowerCase()):"@visitor_country_code"==b[1]?(g=d.geo.country,g=g.toLowerCase(),h=h.toLowerCase()):"@visitor_country_name"==b[1]?(g=d.geo.country_name,g=g.toLowerCase(),h=h.toLowerCase()):"@visitor_page_url"==b[1]?(g=n.location.href,
g=g.replace(/^(http:\/\/|https:\/\/)/gi,""),h=h.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_page_title"==b[1]?g=s.title:"@visitor_page_count"==b[1]?(g=e.page_visited.length,h=parseInt(h,10)):"@referrer"==b[1]?(g=s.referrer,g=g.replace(/^(http:\/\/|https:\/\/)/gi,""),h=h.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_name"==b[1]?g=f.name||"":"@visitor_email"==b[1]?g=f.email||"":"@visitor_phone"==b[1]?g=f.phone||"":"@visitor_referrer"==b[1]?(g=e.v.referrer,g=g.replace(/^(http:\/\/|https:\/\/)/gi,
""),h=h.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_search_engine"==b[1]?g=e.se&&e.se.name?e.se.name:"":"@visitor_search_terms"==b[1]?g=e.se&&e.se.kw?e.se.kw:"":"@visitor_type"==b[1]?(g=e.v.type,h=h.toLowerCase()):"@visitor_device"==b[1]?(g=Ca.detect()||"desktop",h=h.toLowerCase()):"@visitor_label"==b[1]&&(g=f.labels||[]);(k=qc(g,b[0],h))?m++:c&&(!p||c<p)&&(p=c);t(g+" "+b[0]+" "+h+" = "+k)});var r=0;"and"==k&&m==q.size(l)&&(r=1);"or"==k&&0<m&&(r=1);g.is_match=r;g.is_check=1;xa[g.id]={is_match:r,
is_check:1};E.set("trigger_result",xa,9E5);t("trigger result :",xa);if(r)t("matched"),rc(g)&&G("cev",{ev:"trigger_result",id_trigger:g.id,status:"success",time:w()});else{t("NOT matched");if("page_enter"!=b)return!1;k=(new Date).getTime();p&&p>=k&&(k=p-k+1E3,t("check again after "+k+"ms"),F[h]=setTimeout(function(){bb(b,g.id)},k))}})},qc=function(b,c,d){return"eq"==c?q.isArray(b)?q.contains(b,d)?!0:!1:b===d?!0:!1:"neq"==c?b!==d?!0:!1:"lt"==c?b<d?!0:!1:"gt"==c?b>d?!0:!1:"lte"==c?b<=d?!0:!1:"gte"==
c?b>=d?!0:!1:"icontains"==c?(b=(b+"").indexOf(d,0),-1===b?!1:!0):"nicontains"==c?(c=new RegExp(d,"g"),b=c.test(b),!1===b?!0:!1):"iregex"==c?(c=new RegExp(d,"gi"),(b=c.test(b))?!0:!1):"true"==c?!0===b?!0:!1:"false"==c?!1===b?!0:!1:!1},rc=function(b){var c=!1;q.find(b.data.actions,function(d,e){t("run trigger action :",d);if("autoInvite"==d[0]||"sendMessageToVisitor"==d[0]){if("offline"==g.status_account||"offline"==g.status_widget)return t("already return :",g),!0;if("autoInvite"==d[0]){var h=m(f,
"line_message").length,l=k.session;if(0<h||l.agent)return t("already return 1 :",l),!0}else{var J=0;0==Y(f,"supporter_chat, visitor_chat").length&&(J=1)}if(!q.isString(d[1][0])||!q.isString(d[1][1]))return t("already return 2 "),!0;var p={name:d[1][0],avatar:d[1][1]},r=d[2];setTimeout(function(){G("cev",{ev:"trigger_message",from:p,message:r,id_trigger:b.id,url:n.location.href,time:w()})},200);Aa(p,r);Oa(0);m(f,"avatar_supporter",function(b){C(b,"img",function(b){D.set(b,"src",R(p.avatar))})});m(f,
"name_supporter",function(b){H(b,q.escape(p.name))});"offline"==g.status_widget&&(g.status_widget="online",ka(0),la(1));"survey"==g.widget_window?(na(0),ja(1)):"online_compress"==g.widget_window&&("autoInvite"==d[0]?m(f,"button_chat_online",function(b){("desktop"==k._device||g._sbz_is_new_window)&&b.click()}):J?m(f,"button_chat_online",function(b){("desktop"==k._device||g._sbz_is_new_window)&&b.click()}):(Kb(),N("online")));Lb();g._sbz_is_new_window||"desktop"==k._device||Pa(1);Mb();c=!0}else"applyToLabel"==
d[0]?(G("cev",{ev:"add_label",labels:d[1],id_trigger:b.id,url:n.location.href,time:w()}),q.each(d[1],function(b){ab("Subiz Labels","TriggerAddLabel",b)}),c=!0):"removeToLabel"==d[0]&&(G("cev",{ev:"remove_label",labels:d[1],id_trigger:b.id,url:n.location.href,time:w()}),q.each(d[1],function(b){ab("Subiz Labels","TriggerRemovedLabel",b)}),c=!0)});return c},Nb=function(){var b={widget:g.status_widget,account:g.status_account,department:"",agent:""},c=k.session;c.department&&q.each(k.departments,function(d){d.name==
c.department&&(b.department=d.status)});c.agent&&q.each(k.agents,function(d){d.username==c.agent&&(b.agent="offline"==d.state?"offline":"online")});return b},sb=function(){var b=k.session.department||"",c="";"online"==g.status_widget?C(h(f,"department"),"select",function(b){c=b.value}):C(h(l,"department"),"select",function(b){c=b.value;q.isEmpty(c)&&C(h(l,"department_edit"),"select",function(b){c=b.value})});q.isEmpty(c)||(b=c);C(h(f,"department"),"select",function(b){b.options.length=0;b.options.add(new Option(k.lang.online.department_help,
""));q.each(k.departments,function(c){"online"==c.status&&b.options.add(new Option(c.name,c.name))})});C(h(l,"department"),"select",function(b){b.options.length=0;b.options.add(new Option(k.lang.online.department_help,""));q.each(k.departments,function(c){b.options.add(new Option(c.name,c.name))})});C(h(l,"department_edit"),"select",function(b){b.options.length=0;b.options.add(new Option(k.lang.online.department_help,""));q.each(k.departments,function(c){b.options.add(new Option(c.name,c.name))})});
q.isEmpty(b)||(C(h(f,"department"),"select",function(c){c.value=b}),C(h(l,"department"),"select",function(c){c.value=b}),C(h(l,"department_edit"),"select",function(c){c.value=b}))},L=function(b,c){if("undefined"==typeof c||!c)return!1;var d=k.visitor,e=q.escape(c);"name"==b?(d.name=c,m(f,"v_name",function(b){b.value=c}),m(l,"v_name",function(b){b.value=c}),m(f,"v_name_text",function(b){H(b,e)}),m(l,"v_name_text",function(b){H(b,e)}),m(f,"visitor_name",function(b){H(b,e)})):"email"==b?(d.email=c,m(f,
"v_email",function(b){b.value=c}),m(l,"v_email",function(b){b.value=c}),m(f,"v_email_text",function(b){H(b,e)}),m(l,"v_email_text",function(b){H(b,e)})):"phone"==b&&(d.phone=c,m(f,"v_phone",function(b){b.value=c}),m(l,"v_phone",function(b){b.value=c}))},db=function(){m(l,"notification_widget",function(b){ba(b)});m(f,"notification_widget",function(b){ba(b)});if("online"==g.status_account){ka(0);la(1);pa(0);ga(0);qa(1);var b=Nb(),c=!1;"offline"==b.agent&&"offline"==b.department&&(c=!0);"active"==k.widget.survey.status&&
c&&1>k.history.length?(ja(0),na(1)):(na(0),ja(1))}else la(0),ka(1),ra(0),sa(1),za(0),Ra(1);va("enable");g.status_widget=g.status_account},Sa=function(){k.session.department?db():va("enable")},pb=function(){pa(0);ga(0);qa(1);var b=!1;if("active"==k.widget.survey.status){var b=!0,c=m(f,"line_message").length;if(k.session.agent||0<c)b=!1}b?(ja(0),na(1)):(na(0),ja(1));Pa(0)},qb=function(){ra(0);sa(1);za(0);Ra(1)},gc=function(){t("io ready");if("offline"==g._status_account)k.socket_ready=!0;else{var b=
ha(),c=fa(),d=[];d.push(g.aid);b&&d.push(b);c&&d.push(c);3>q.size(d)?console.log("Ignore connect socket"):(b=sc(d.join(";")),aa=new cc(g.url_socket,{server:b}),aa.on("open",function(){t("socket connected");g.socket_connected=!0;k.socket_ready=!0}),aa.on("message",function(b){Ib(b)}),aa.on("close",function(){t("socket disconnect");g.socket_connected=!1}),aa.on("reconnect",function(b){t("socket reconnected");g.socket_connected=!0;va("enable");dc();g.click_reconnect&&(delete g.click_reconnect,m(f,"notification_reconnecting",
function(b){ba(b)}),m(l,"notification_reconnecting",function(b){ba(b)}),Sa());Qa()}),aa.on("reconnect_failed",function(){t("socket reconnect failed - show notification");g.socket_connected=!1;k.session&&k.session.agent&&eb();va("disable");ua('Lost connection! <a href="javascript:;" class="link_reconnect">Click here</a> to try reconnect.')}),aa.connect())}},Ib=function(b){t(b);if("init"==b.ev)if(b.session&&b.session.vid){k.session=b.session||{};k.triggers=b.account.triggers||[];k.agents=b.account.agents||
[];k.departments=b.account.departments||[];k.history=b.history||[];k.visitor=b.session.visitor||{};k.visitor_session=b.session.visitor_session||{};tc(b.session.vid);g._sbz_is_new_window||M.set("__sbzsid",b.session.sid);if(g._sbz_is_new_window_pc){var c="offline",d=q.findWhere(b.account.agents,{username:g.sbz_agent});d&&(c=d.state);g.status_widget=c}g.sbz_sid=b.session.sid;g.sbz_vid=b.session.vid;E.remove("is_init");ia("all",{check:function(){return k.base_ready&&k.socket_ready?!0:!1},success:function(){k.all_ready=
!0;uc()},error:function(){mb()}})}else t("init data is error");else if("chat"==b.ev){var e=k.session,c=b.from.split("@")[0],n=Ha(c);n&&(d=0,e.agent||(d=1,e.agent=c,tb(1),Ta(1),Ua(1),ub(1),c=k.lang.other.agent_join_chat,c=c.replace("{agent}",n.name),ua(c),g.status_account="online",m(f,"type_message",function(b){C(b,"textarea",function(b){D.get(b,"disabled")&&va("enable")})}),F.agent_busy&&(clearTimeout(F.agent_busy),F.agent_busy=null)),m(f,"avatar_supporter",function(b){C(b,"img",function(b){D.set(b,
"src",R(n.avatar))})}),m(f,"name_supporter",function(b){H(b,q.escape(n.name))}),m(f,"text_supporter",function(b){H(b,q.escape(n.job_title))}),Aa(n,q.escape(b.message)),Oa(0),"offline"==g.status_widget&&(g.status_widget=g.status_account,ka(0),la(1),pa(0),qa(1),ga(0),na(0),ja(1)),"survey"==g.widget_window?(na(0),ja(1)):"online_compress"==g.widget_window&&(Kb(),N("online"),d&&m(f,"button_chat_online",function(b){("desktop"==k._device||g._sbz_is_new_window)&&b.click()})),Lb(),Mb(),ab("SUBIZ Chat","Agent chat",
e.agent),Va(0))}else if("change_state"==b.ev){var e=k.session,p="",J="offline",r="offline";if(p=Ha(b.agent)){q.each(k.agents,function(c){c.username==b.agent&&(c.state=b.state,p=c);"online"==c.state&&("active"==k.widget.survey.status&&"active"==k.widget.survey.department?0<c.departments.length&&(J="online"):J="online",r="online");"away"==c.state&&c.username==e.agent&&(J="online");"away"==c.state&&"offline"==r&&(r="away")});q.isEmpty(k.departments)||(q.each(k.departments,function(b,c){b.status="offline";
q.each(k.agents,function(c){"online"==c.state&&0<c.departments.length&&q.contains(c.departments,b.name)&&(b.status="online")})}),sb());g.status_account=J;var d=Nb(),v=g.widget_window;"offline"==d.widget&&(!e.department&&"online"==d.account||e.department&&"online"==d.department)&&("offline_compress"==v?(ka(0),la(1),qa(0),vb(),pa(1)):(c=k.lang.other.agent_online,c=c.replace("{agent}",p.name),wb(c,"account_online")));if("online"==d.widget&&"offline"==d.account)if("online_compress"==v){if(0<cb())return;
la(0);ka(1);sa(0);xb();ra(1)}else va("disable"),wb(k.lang.other.agent_offline,"account_offline");g.status_widget=J;g._status_account=r;e.agent&&e.agent==b.agent&&"offline"==b.state&&(eb(),va("disable"))}else t("change_state - agent not in list")}else if("agent_connection"==b.ev){if(e=k.session,e.agent&&e.agent==b.agent&&(p=Ha(b.agent)))"disconnect"==b.state?(c=k.lang.other.agent_disconnect,c=c.replace("{agent}",p.name),ua(c)):"connect"==b.state&&(c=k.lang.other.agent_reconnect,c=c.replace("{agent}",
p.name),ua(c))}else if("chatstates"==b.ev)e=k.session,c=b.from.split("@")[0],e.agent&&e.agent==c&&("composing"==b.state?Va(1,c):"paused"==b.state&&Va(0));else if("sync"==b.ev)b.name&&L("name",b.name),b.email&&L("email",b.email),b.phone&&L("phone",b.phone),b.message&&(Aa("",b.message),Oa(0),ka(0),la(1),m(f,"button_chat_online",function(b){("desktop"==k._device||g._sbz_is_new_window)&&b.click()})),"undefined"==typeof b.is_expand||"desktop"!=k._device&&!g._sbz_is_new_window||(c=1==b.is_expand?0:1,d=
1==b.is_expand?1:0,g.is_expand=parseInt(b.is_expand,10),"online"==g.status_widget?(pa(c),qa(d)):(ra(c),sa(d)));else if("block"==b.ev)m(s,"sbzon",function(b){ba(b)}),m(s,"sbzoff",function(b){ba(b)}),mb(),M.set("__sbzbl","1",365);else if("transfer"==b.ev){if(e=k.session,d=Ha(e.agent))c=k.lang.other.agent_left_chat,c=c.replace("{agent}",d.name),eb({message:c}),e.last_agent=e.agent,delete e.agent,delete e.department,Sa(),Va(0)}else if("end_chat"==b.ev){if(e=k.session,d=Ha(e.agent))e.last_agent=e.agent,
delete e.agent,c=k.lang.other.agent_end_chat,c=c.replace("{agent}",d.name),ua(c),Va(0),Ta(0),Ua(0),E.remove("time_message"),E.remove("agent_busy")}else"full_slot"==b.ev?(d=k.session.visitor,c="",(v=q.last(m(f,"visitor_content_chat")))&&(c=jb(v)),c&&(d.name||d.email?h(l,"v_message_offline").value=c:h(l,"v_message_offline_edit").value=c),la(0),ka(1),ra(0),sa(1),Ra(1)):"close"==b.ev?mb():"lost_slot"==b.ev?(e=k.session,e.slot=""):"receive_slot"==b.ev?b.slot&&(e=k.session,e.slot=b.slot,Qa()):"set_sid"==
b.ev?b.sid&&(g._sbz_is_new_window||M.set("__sbzsid",b.sid),g.sbz_sid=b.sid):"presence"==b.ev?Qa():"read"==b.ev&&vc()},ia=function(b,c){c=c||{};X[b]||(X[b]={time:0,expire:c.expire||6E4});X[b].id&&(clearTimeout(X[b].id),X[b].id=null);var d=new Date;if(0<X[b].time){if(d.getTime()-X[b].time>X[b].expire){t("wait ready is timeout : "+b);c.error&&c.error();return}}else X[b].time=d.getTime();c.check()?(t(b+" is ready"),c.success()):X[b].id=setTimeout(function(){t(b+" is not ready");ia(b,c)},c.delay||200)},
fc=function(){n.addEventListener("resize",function(){N(g.status_widget)});var b={config:g,lang:k.lang};k.html.online=q.template(k.html.online,b);k.html.offline=q.template(k.html.offline,b);var b=["online","offline"],c=b.length;q.each(b,function(b){var e="online"==b?"sbzon":"sbzoff",n=q.template(k.html.iframe,{name:e});(function(b,d,e){e=s.createElement("div");e.setAttribute("class",d);e.style.display="none";e.innerHTML='<iframe id="'+d+'_frame" frameborder="0" style="background-color: transparent; vertical-align: text-bottom; position: relative; width: 100%; height: 100%; margin: 0px; overflow: hidden;"></iframe>';
C(e,"iframe",function(b){D.set(b,"src","javascript:false")});s.body.appendChild(e);e=h(s,d+"_frame").contentWindow.document;e.write("<!DOCTYPE html><html><head></head><body></body></html>");e.close();setTimeout(function(){var e={"margin-top":"0px","margin-right":"0px","margin-bottom":"0px",padding:"0px",border:"0px","background-color":"rgba(0, 0, 0, 0)",overflow:"hidden",position:"fixed","z-index":"16000001",bottom:"0px",display:"block",width:"310px",height:"431px"};e["left"==g.position?"left":"right"]=
"10px";m(s,d,function(b){x.set(b,e)});var n=h(s,d+"_frame").contentWindow.document;"online"==b?f=n:"offline"==b&&(l=n);C(n,"head",function(b){$(b,"<style>"+k.css+"</style>")});C(n,"body",function(c){$(c,k.html[b])});c--;0==c&&(k.base_ready=!0);k.base_ready&&("online"==g.status_widget?(ka(0),la(1),g._sbz_is_new_window?(ja(0),yb(1),qa(1),pa(0)):(qa(0),pa(1)),"desktop"==k._device||g._sbz_is_new_window||vb()):(la(0),ka(1),g._sbz_is_new_window?(za(0),Ra(0),zb(1),sa(1),ra(0)):(sa(0),ra(1)),"desktop"==k._device||
g._sbz_is_new_window||xb()),k.widget.theme.url_twitter&&(C(h(f,"twitter"),"a",function(b){D.set(b,"href",k.widget.theme.url_twitter)}),v(h(f,"twitter")),C(h(l,"twitter"),"a",function(b){D.set(b,"href",k.widget.theme.url_twitter)}),v(h(l,"twitter")),m(f,"btnoption",function(b){x.set(b,"margin-left","10px")})),k.widget.theme.url_facebook&&(C(h(f,"facebook"),"a",function(b){D.set(b,"href",k.widget.theme.url_facebook)}),v(h(f,"facebook")),C(h(l,"facebook"),"a",function(b){D.set(b,"href",k.widget.theme.url_facebook)}),
v(h(l,"facebook")),m(f,"btnoption",function(b){x.set(b,"margin-left","10px")})),"active"==k.widget.theme.logo_status&&k.widget.theme.logo_image&&(m(f,"logo_company",function(b){C(b,"img",function(b){D.set(b,"src",R(k.widget.theme.logo_image))})}),wc(1)),"off"==M.get("__sbzbubble")&&(g.bubble="off",ga(0)),"active"==k.widget.chat_bubble.status&&(C(h(f,"bubble_image"),"img",function(b){D.set(b,"src",R(k.widget.chat_bubble.image))}),C(h(f,"bubble_image"),"img",function(b){p.on(b,"load",function(){t("bubble",
g.bubble);g.bubble&&"off"==g.bubble||("desktop"!=k._device?ga(0):ga(1),N("online"));g.is_expand&&ga(0)})}),f.getElementById("bubble_image").addEventListener("click",function(){Ba()}),p.on(h(f,"bubble_close"),"click",function(){ga(0);g.bubble="off";M.set("__sbzbubble",g.bubble)})),n=Y(s,"#subiz_status, .subiz_status"),0<n.length&&ac(n,function(b){"online"==g.status_account?H(b,k.widget.chat_button.online_code):H(b,k.widget.chat_button.offline_code);if("desktop"==k._device)p.on(b,"click",function(){"online"==
g.status_account?g.is_expand||pb():g.is_expand||qb()});else p.on(b,"click",function(){"online"==g.status_account?Ba():Ga()})}),p.on(f,"touchstart",".button_chat_online",Ba),p.on(f,"click",".button_chat_online",Ba),p.on(f,"click",".online_heading",function(){"desktop"==k._device&&(g.is_expand=0,G("cev",{ev:"sync",is_expand:0,time:w()}),qa(0),pa(1),"active"!=k.widget.chat_bubble.status||g.bubble&&"off"==g.bubble||("desktop"!=k._device?ga(0):ga(1),N("online")))}),"desktop"!=k._device&&("online"==g.status_account?
f.getElementsByClassName("widget_body_footer")[0]:l.getElementsByClassName("widget_body_footer")[0]).lastElementChild.setAttribute("href","javascript:void(0)"),p.on(l,"touchstart",".button_chat_offline",Ga),p.on(l,"click",".button_chat_offline",Ga),p.on(l,"click",".offline_heading",function(){"desktop"==k._device&&(g.is_expand=0,G("cev",{ev:"sync",is_expand:0,time:w()}),sa(0),ra(1))}))},50)})(b,e,n)})},Ba=function(){if("desktop"==k._device||g._sbz_is_new_window)g.is_expand||G("cev",{ev:"sync",is_expand:1,
time:w()}),g.is_expand=1,k.all_ready?(pb(),g.chat_requested||(g.chat_requested=1,ia("trigger_chat_requested",{check:function(){return k.session_ready?!0:!1},success:function(){bb("chat_requested")}}))):(na(0),ja(0),yb(1),pa(0),qa(1)),"active"==k.widget.chat_bubble.status&&ga(0);else{var b=g.url_new_window,c=ha(),d=fa(),e={};e.id=g.aid;e.sid=d;e.vid=c;e.wopen=k._device;e=P.stringify(e);e=btoa(e);url_str="?param="+e;b+=url_str;$a=n.open(b,"subizNewWindow");$a.focus();Pa(0)}},Ga=function(){if("desktop"==
k._device||g._sbz_is_new_window)g.is_expand||G("cev",{ev:"sync",is_expand:1,time:w()}),g.is_expand=1,k.all_ready?(t("click expand widget offline - all ready"),qb()):(t("click expand widget offline - all NOT ready"),Fb(h(l,"subiz_loading"))&&(t("click expand widget offline - show loading"),za(0),Ra(0),zb(1),ra(0),sa(1)));else{var b=g.url_new_window,c=ha(),d=fa(),e={};e.id=g.aid;e.sid=d;e.vid=c;e.wopen=k._device;e=P.stringify(e);e=btoa(e);url_str="?param="+e;b+=url_str;$a=n.open(b,"subizNewWindow");
$a.focus()}},uc=function(){t("Yes! Let's go!");var b=k.widget.survey,c=k.widget.offline_survey||{};q.isEmpty(k.departments)&&(b.department.status="inactive",c.department.status="inactive");"active"==b.status&&("active"==b.name.status?Ob(1):Ob(0),"active"==b.email.status?Pb(1):Pb(0),"active"==b.phone.status?Qb(1):Qb(0),"active"==b.question.status?Rb(1):Rb(0),"active"==b.department.status?(sb(),Sb(1)):Sb(0));"active"==c.name.status?Tb(1):Tb(0);"active"==c.email.status?Ub(1):Ub(0);"active"==c.phone.status?
Vb(1):Vb(0);"active"==c.department.status?(sb(),Wb(1)):Wb(0);b=k.visitor;b.name&&L("name",b.name);b.email&&L("email",b.email);b.phone&&L("phone",b.phone);var d=k.session;d.agent?(q.each(k.agents,function(b){b.username==d.agent&&(m(f,"avatar_supporter",function(c){C(c,"img",function(c){D.set(c,"src",R(b.avatar))})}),m(f,"name_supporter",function(c){H(c,q.escape(b.name))}),m(f,"text_supporter",function(c){H(c,q.escape(b.job_title))}))}),q.each(d.agents_rated,function(b,c){"good"==b?m(f,"rate-good",
function(b){y.add(b,"rated")}):"bad"==b&&m(f,"rate-bad",function(b){y.add(b,"rated")})}),tb(1),Ta(1),ub(1),Ua(1)):(tb(0),Ta(0),ub(0),Ua(0));if(0<k.history.length){Oa(0);var e="",S="";q.each(k.history,function(b){"agent"==b.from.type?q.each(k.agents,function(c){c.username==b.from.user&&(e=c,Aa(c,q.escape(b.message)))}):"visitor"==b.from.type?Aa("",q.escape(b.message)):"trigger"==b.from.type?(S=b.from.user,Aa(b.from.user,b.message)):"system"==b.from.type&&ua(b.message)});!e&&S&&(e=S);e&&(m(f,"avatar_supporter",
function(b){C(b,"img",function(b){D.set(b,"src",R(e.avatar))})}),m(f,"name_supporter",function(b){H(b,q.escape(e.name))}))}yb(0);zb(0);t("restore session");pc();q.isEmpty(k.triggers)||ia("trigger_page_enter",{check:function(){return k.session_ready?!0:!1},success:function(){bb("page_enter")}});g.socket_connected&&Qa();p.on(f,"click",".btn_start_chat",lc);p.on(f,"click",".btnoption",function(){m(f,"option_form",function(b){Fb(b)?oa(1):oa(0)})});p.on(Y(f,".option_config_sound label, .option_config_sound i"),
"click",function(){m(f,"option_config_sound",function(b){C(b,"i",function(b){y.has(b,"icon_sound")?(rb("off"),k.session.sound="off"):(rb("on"),k.session.sound="on")})})});p.on(h(f,"close_option"),"click",function(){oa(0)});p.on(f,"click",".btn_endchat",Xb);p.on(h(f,"end_chat_footer"),"click",Xb);p.on(h(f,"ec_close"),"click",function(){Wa(0)});p.on(h(f,"edit_contact"),"click",function(){Xa(0);var b=k.visitor;b.name||b.email?(Na(1),v(h(f,"v_name_contact_view")),b.name||r(h(f,"v_name_contact_view")),
v(h(f,"v_email_contact_view")),b.email||r(h(f,"v_email_contact_view"))):Ma(1)});p.on(h(f,"edit_successful"),"click",mc);p.on(h(f,"icon_edit_contact"),"click",function(){Na(0);Ma(1)});p.on(h(f,"icon_close_contact"),"click",function(){oa(0)});p.on(h(f,"email_transcript"),"click",function(){Xa(0);Ab(1)});p.on(h(f,"save_email_transcript"),"click",nc);p.on(h(f,"cancel_email_transcript"),"click",function(){oa(0)});p.on(h(f,"cancel_contact"),"click",function(){oa(0)});p.on(f,"click",".visitor_name",function(){oa(1);
Xa(0);h(f,"edit_contact").click()});p.on(h(f,"rate_good"),"click",hc);p.on(h(f,"rate_bad"),"click",ic);p.on(h(f,"ec_rate_good"),"click",function(){h(f,"rate_good").click();Wa(0)});p.on(h(f,"ec_rate_bad"),"click",function(){h(f,"rate_bad").click();Wa(0)});m(f,"textarea_online",function(b){p.on(b,"keypress",oc);p.on(b,"blur",function(){if(k.session.is_typing){k.session.is_typing=!1;var b={ev:"chatstates",state:"paused",time:w()};G("cev",b)}})});p.on(f,"click",".link_offline",function(){if("offline"==
g.status_account){var b="";m(f,"type_message",function(c){C(c,"textarea",function(c){b=c.value})});m(l,"textarea_offline",function(c){c.value=b})}db()});p.on(h(l,"send_message_offline"),"click",jc);p.on(h(l,"send_message_offline_edit"),"click",kc);p.on(h(l,"icon_edit_contact_offline"),"click",function(){Fa(0);La(1)});p.on(h(l,"v_message_offline"),"change",function(){var b=h(l,"v_message_offline").value;h(l,"v_message_offline_edit").value=b;H(h(l,"message_offline_text"),q.escape(b))});p.on(h(l,"v_message_offline_edit"),
"change",function(){var b=h(l,"v_message_offline_edit").value;h(l,"v_message_offline").value=b;H(h(l,"message_offline_text"),q.escape(b))});p.on(l,"click",".btn_send_another",function(){za(0);Fa(1);h(l,"v_message_offline").value="";h(l,"v_message_offline_edit").value=""});p.on(f,"click",".close_notification_widget",function(){var b=this;m(f,"chat_warning",function(c){gb(c,b)&&ba(c)})});p.on(l,"click",".close_notification_widget",function(){var b=this;m(l,"chat_warning",function(c){gb(c,b)&&ba(c)})});
p.on(f,"click",".link_reconnect",function(){g.socket_connected?Sa():(wb("Reconnecting...","reconnecting"),g.click_reconnect=1,g.socket_connected||aa.reconnect())});p.on(f,"click",".link_refresh",function(){db()});p.on(l,"click",".link_refresh",function(){db()});p.on(f,"click",".link_chat_again",function(){Sa()});p.on(h(f,"ec_chat_again"),"click",function(){Wa(0);Sa()});n.addEventListener("unload",function(){var b=fa();b&&(g._sbz_is_new_window||M.set("__sbzsid",b,60/86400),g.sbz_sid=b);E.remove("is_init");
k.session_ready&&(E.set("trigger_result",xa,9E5),b=cb(),0<b&&E.set("new_message",b,9E5),k.session&&"off"==k.session.sound&&E.set("sound","off",9E5),g.bubble&&E.set("bubble",g.bubble,9E5))},!1);b=function(b){nb=b.type};n.addEventListener("blur",b,!1);n.addEventListener("focus",b,!1);g.idle_time=0;g.is_idle=0;d.status_activity&&"idle"==d.status_activity&&(g.is_idle=1);var s=function(){g.idle_time+=1;5<=g.idle_time&&(t("visitor idle"),g.is_idle||(g.is_idle=1,G("cev",{ev:"change_activity",status:"idle"})),
F.idle&&(clearInterval(F.idle),F.idle=null))},b=function(){g.idle_time=0;g.is_idle&&(t("visitor active"),g.is_idle=0,G("cev",{ev:"change_activity",status:"active"}));F.idle||(F.idle=setInterval(s,6E4))};b();n.addEventListener("mousemove",b,!1);n.addEventListener("keypress",b,!1);f.addEventListener("mousemove",b,!1);f.addEventListener("keypress",b,!1)},Ha=function(b){var c="";q.each(k.agents,function(d){d.username==b&&(c=d)});return c},Xb=function(){var b=Ha(k.session.agent);if(b){var c=k.lang.online.ec_message,
c=c.replace("{agent}",q.escape(b.name));Y(f,".endchat_form .endchat_label",function(b){H(b,c)});oa(0);Wa(1);eb();G("cev",{ev:"end_chat",time:w()})}},eb=function(b){var c=k.lang.other.visitor_end_chat;"undefined"!=typeof b&&b.message&&(c=b.message);ua(c);va("disable");Ta(0);Ua(0);b=k.session;b.last_agent=b.agent;delete b.agent;E.remove("time_message");E.remove("agent_busy")},ab=function(b,c,d){"function"==typeof n.ga&&("undefined"!=typeof d?n.ga("send","event",b,c,d):n.ga("send","event",b,c))},Kb=
function(){var b=cb();b++;Pa(b)},Lb=function(){var b=g.new_message_on_page||0,c=cb();0<c?Yb("("+c+") "+Ia):"blur"==nb&&(b++,g.new_message_on_page=b,Yb("("+b+") "+Ia));g._sbz_is_new_window&&(n.addEventListener("focus",wa,!1),n.addEventListener("mousemove",wa,!1),f.addEventListener("focus",wa,!1),f.addEventListener("mousemove",wa,!1))},ha=function(){var b="",c=E.get("id")||"",d=M.get("__sbzid")||"";if("desktop"!=k._device&&g._sbz_is_new_window||g._sbz_is_new_window_pc||g._sbz_is_new_window)return b=
g.sbz_vid;c?(b=c,d||M.set("__sbzid",b,365)):d&&(b=d,E.set("id",b));return b},fa=function(){var b="";return g._sbz_is_new_window&&(b=g.sbz_sid)||(b=g.sbz_sid)?b:b=M.get("__sbzsid")||""},tc=function(b){g._sbz_is_new_window||g._sbz_is_new_window_pc||(E.set("id",b),M.set("__sbzid",b,365))},Mb=function(){var b=k.session.sound||"on";"blur"==nb&&"on"==b&&h(f,"audio_alert").play()},xc={_setAccount:function(b){g.aid=b;b=ha();var c=fa(),d=E.get("is_init")||0;b&&c||!d?Jb():ia("other_init",{check:function(){var b=
ha(),c=fa(),d=E.get("is_init")||0;return b&&c||!d?!0:!1},success:function(){Jb()}})},expandWidget:function(){var b="api_expand_widget:"+(new Date).getTime();ia(b,{check:function(){return k.base_ready?!0:!1},success:function(){g.is_expand||("online"==g.status_widget?Ba():Ga())}})},setInfo:function(b){"undefined"==typeof b||1>b.length||ia("api_set_info",{check:function(){return k.all_ready&&k.socket_ready?!0:!1},success:function(){var c=q.pick(b,["name","email","phone"]);q.each(c,function(b,d){q.isEmpty(b)&&
delete c[d]});if(!q.isEmpty(c))if(q.each(c,function(b,c){"email"==c?Ka(b)&&L(c,b):L(c,b)}),"offline"==g._status_account){var d=ha(),e=fa(),d={aid:g.aid,vid:d,sid:e},d=q.extend(d,c);ya(g.url_sock_p+"ev/set_info",{data:d,success:function(b){},error:function(b){}})}else G("cev",q.extend(c,{ev:"set_info"}))}})}},R=function(b){if(!b)return"";var c="https:"==s.location.protocol?"https://":"http://";b=b.replace(/^https?\:\/\//gi,"");return c+b},yc=function(b){var c=n.innerHeight,d,e,g,h;if("online"==b){m(f,
"widget_body_inner",function(b){});m(f,"online_heading",function(b){d=b.offsetHeight});m(f,"widget_body_footer",function(b){e=b.offsetHeight});m(f,"type_message",function(b){g=b.offsetHeight});m(f,"widget_online_top",function(b){h=b.offsetHeight});var p=c-d-e,q=c-d-e-g-h;m(f,"widget_body",function(b){x.set(b,"height",c-10+"px")});m(f,"widget_body_inner",function(b){x.set(b,"height",p-12+"px")});m(f,"subiz_conversionin",function(b){x.set(b,"height",q-35+"px")})}else m(l,"widget_body_inner",function(b){}),
m(l,"offline_heading",function(b){d=b.offsetHeight}),m(l,"widget_body_footer",function(b){e=b.offsetHeight}),m(l,"type_message",function(b){g=b.offsetHeight}),m(l,"widget_online_top",function(b){h=b.offsetHeight}),p=c-d-e,q=c-d-e-g-h,m(l,"widget_body",function(b){x.set(b,"height",c-10+"px")}),m(l,"widget_body_inner",function(b){x.set(b,"height",p-12+"px")}),m(l,"subiz_conversionin",function(b){x.set(b,"height",q-35+"px")});m(s,"sbzon",function(b){x.set(b,"right","0px");x.set(b,"left","0px")});m(s,
"sbzoff",function(b){x.set(b,"right","0px");x.set(b,"left","0px")});"desktop"!=k._device&&m(f,"textarea_online",function(b){D.set(b,"rows","1")})},W=function(b,c){x.set(b,{transform:"scale("+c+")","-ms-transform":"scale("+c+")","-moz-transform":"scale("+c+")","-webkit-transform":"scale("+c+")","-o-transform":"scale("+c+")"})},zc=function(b){var c=n.innerHeight,d=n.innerWidth,e=s.doctype,g=!1;e&&e.publicId&&(e=e.publicId,e=e.toLowerCase(),-1<e.indexOf("-//wapforum//dtd xhtml mobile")&&(g=!0));"online"==
b?(s.querySelector("meta[name=viewport]")||1==g?(m(f,"button_chat_online",function(b){W(b,1)}),s.querySelector("meta[name=viewport]")||1!=g||!Ca.iphone()&&!Ca.ipod()||(d>c?m(f,"button_chat_online",function(b){W(b,1.3)}):m(f,"button_chat_online",function(b){W(b,2.3)}))):("mobile"==k._device&&(t("mobile",d,c),d>c?m(f,"button_chat_online",function(b){W(b,1.3)}):m(f,"button_chat_online",function(b){W(b,2.3)})),"tablet"==k._device&&(d>c?m(f,"button_chat_online",function(b){W(b,1)}):m(f,"button_chat_online",
function(b){W(b,1.5)}))),vb()):(s.querySelector("meta[name=viewport]")||1==g?(m(l,"button_chat_offline",function(b){W(b,1)}),s.querySelector("meta[name=viewport]")||1!=g||!Ca.iphone()&&!Ca.ipod()||(d>c?m(l,"button_chat_offline",function(b){W(b,1.3)}):m(l,"button_chat_offline",function(b){W(b,2.3)}))):("mobile"==k._device&&(d>c?m(l,"button_chat_offline",function(b){W(b,1.3)}):m(l,"button_chat_offline",function(b){W(b,2.3)})),"tablet"==k._device&&(d>c?m(l,"button_chat_offline",function(b){W(b,1)}):
m(l,"button_chat_offline",function(b){W(b,1.5)}))),xb())},w=function(){return Math.floor(+new Date/1E3)},t=function(){!Hb||1>arguments.length||Function.prototype.apply.call(console.log,console,arguments)},wa=function(b){g._sbz_is_new_window&&G("cev",{ev:"read",ev_type:"forward"});n.removeEventListener("focus",wa,!1);n.removeEventListener("mousemove",wa,!1);f.removeEventListener("focus",wa,!1);f.removeEventListener("mousemove",wa,!1);b.preventDefault()},ma=function(){t("clear blink");F.new_message&&
(clearInterval(F.new_message),F.new_message=null);s.title=Ia;g.new_message_on_page=0;n.removeEventListener("mousemove",ma);n.removeEventListener("focus",ma);f.removeEventListener("mousemove",ma);f.removeEventListener("focus",ma)},Yb=function(b){var c=function(){s.title=s.title==Ia?b:Ia},d=g.new_message_on_page||0;ma();g.new_message_on_page=d;F.new_message||(t("set blink"),F.new_message=setInterval(c,500),n.addEventListener("mousemove",ma,!1),n.addEventListener("focus",ma,!1),f.addEventListener("mousemove",
ma,!1),f.addEventListener("focus",ma,!1))},sc=function(b){for(var c="0x",d=b.length,e=0;e<d;e++)c+=b.charCodeAt(e).toString(16);return c},ec=function(b,c){var d="",e="";for(i=0;i<c.length;i++)0>e.indexOf(c.charAt(i))&&(e+=c.charAt(i));var f=e.length;for(i=0;i<=b.length-1;i++){a=parseInt(b.charCodeAt(i));13==a&&(a=13);10==a&&(a=10);if(13!=a&&10!=a){var g=i%f;a=parseInt(b.charCodeAt(i)-e.charCodeAt(f-1)-g);for(126<a&&(a%=94);32>a;)a=a%94+94}d+=String.fromCharCode(parseInt(a))}return d},Ka=function(b){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(b||
"")},ta="push slice apply length reverse pop _sbzq".split(" "),Ac=ta[0],Zb=function(b){var c=b[0];b=b[ta[1]](1);xc[c][ta[2]](this,b)},f=null,l=null,la=function(b){b?(m(s,"sbzon",function(b){v(b)}),g.status_widget="online"):m(s,"sbzon",function(b){r(b)})},ka=function(b){b?(m(s,"sbzoff",function(b){v(b)}),g.status_widget="offline"):m(s,"sbzoff",function(b){r(b)})},N=function(b,c){"desktop"!=k._device&&g._sbz_is_new_window&&yc(b);if("desktop"==k._device||g._sbz_is_new_window)if("online"==b){m(s,"sbzon",
function(b){x.set(b,{width:"100%",height:"100%"})});var d=h(f,"subiz_wrapper").offsetWidth,e=h(f,"subiz_wrapper").offsetHeight;m(s,"sbzon",function(b){x.set(b,{width:d+1,height:e})});"undefined"!=typeof c&&("undefined"!=typeof c.height&&c.height&&m(s,"sbzon",function(b){x.set(b,"height",c.height)}),"undefined"!=typeof c.width&&c.width&&m(s,"sbzon",function(b){x.set(b,"width",c.width)}))}else m(s,"sbzoff",function(b){x.set(b,{width:"100%",height:"100%"})}),d=h(l,"subiz_wrapper").offsetWidth,e=h(l,
"subiz_wrapper").offsetHeight,m(s,"sbzoff",function(b){x.set(b,{width:d+1,height:e})}),"undefined"!=typeof c&&("undefined"!=typeof c.height&&c.height&&m(s,"sbzoff",function(b){x.set(b,"height",c.height)}),"undefined"!=typeof c.width&&c.width&&m(s,"sbzoff",function(b){x.set(b,"width",c.width)}));else zc(b)},pa=function(b){b?(m(f,"button_chat_online",function(b){v(b)}),N("online"),g.widget_window="online_compress"):m(f,"button_chat_online",function(b){r(b)})},qa=function(b){b?(m(f,"widget_body",function(b){v(b)}),
N("online")):m(f,"widget_body",function(b){r(b)})},vb=function(){var b,c;m(f,"button_chat_online",function(d){b=d.getBoundingClientRect().width;c=d.getBoundingClientRect().height});m(s,"sbzon",function(c){x.set(c,"width",b+"px")});m(s,"sbzon",function(b){x.set(b,"height",c+"px")})},xb=function(){var b,c;m(l,"button_chat_offline",function(d){b=d.getBoundingClientRect().width;c=d.getBoundingClientRect().height});m(s,"sbzoff",function(c){x.set(c,"width",b+"px")});m(s,"sbzoff",function(b){x.set(b,"height",
c+"px")})},ra=function(b){b?(m(l,"button_chat_offline",function(b){v(b)}),N("offline"),g.widget_window="offline_compress"):m(l,"button_chat_offline",function(b){r(b)})},sa=function(b){b?(m(l,"widget_body",function(b){v(b)}),N("offline")):m(l,"widget_body",function(b){r(b)})},ja=function(b){b?(v(h(f,"subiz_chat")),N("online"),Bb(),g.widget_window="chat"):r(h(f,"subiz_chat"))},oa=function(b){b?(Ma(0),Na(0),Ab(0),Xa(1),m(f,"option_form",function(b){v(b)})):(m(f,"option_form",function(b){r(b)}),Ma(0),
Na(0),Ab(0),Xa(1))},Xa=function(b){b?v(h(f,"option_default")):r(h(f,"option_default"))},tb=function(b){b?v(h(f,"email_transcript").parentNode):r(h(f,"email_transcript").parentNode)},Ta=function(b){b?v(h(f,"btn_endchat").parentNode):r(h(f,"btn_endchat").parentNode)},rb=function(b){"on"==b?m(f,"option_config_sound",function(b){C(b,"i",function(b){y.remove(b,"icon_sound_off");y.add(b,"icon_sound")})}):m(f,"option_config_sound",function(b){C(b,"i",function(b){y.remove(b,"icon_sound");y.add(b,"icon_sound_off")})})},
Wa=function(b){b?m(f,"endchat_form",function(b){x.set(b,"display","inline")}):m(f,"endchat_form",function(b){r(b)})},Ma=function(b){b?v(h(f,"option_contact_details")):r(h(f,"option_contact_details"))},Na=function(b){b?v(h(f,"option_edit_successful")):r(h(f,"option_edit_successful"))},Ab=function(b){b?v(h(f,"option_email_transcript")):r(h(f,"option_email_transcript"))},Pa=function(b){b&&0<b?m(f,"notice_new_message",function(c){H(c,b+"");v(c)}):m(f,"notice_new_message",function(b){H(b,"0");r(b)})},
ub=function(b){b?v(h(f,"bl_rating")):r(h(f,"bl_rating"))},na=function(b){b?(v(h(f,"survey")),N("online"),g.widget_window="survey"):r(h(f,"survey"))},Ob=function(b){b?v(Q(h(f,"v_name_survey"),"div")):r(Q(h(f,"v_name_survey"),"div"))},Pb=function(b){b?v(Q(h(f,"v_email_survey"),"div")):r(Q(h(f,"v_email_survey"),"div"))},Qb=function(b){b?v(Q(h(f,"v_phone_survey"),"div")):r(Q(h(f,"v_phone_survey"),"div"))},Rb=function(b){b?v(Q(h(f,"v_question_survey"),"div")):r(Q(h(f,"v_question_survey"),"div"))},Sb=function(b){b?
v(h(f,"department")):r(h(f,"department"))},Tb=function(b){b?v(Q(h(l,"v_name_offline"),"div")):r(Q(h(l,"v_name_offline"),"div"))},Ub=function(b){b?v(Q(h(l,"v_email_offline"),"div")):r(Q(h(l,"v_email_offline"),"div"))},Vb=function(b){b?v(Q(h(l,"v_phone_offline"),"div")):r(Q(h(l,"v_phone_offline"),"div"))},Wb=function(b){b?(v(h(l,"department_edit")),v(h(l,"department"))):(r(h(l,"department_edit")),r(h(l,"department")))},Fa=function(b){b?(v(h(l,"offline_active_box")),N("offline"),g.widget_window="message_offline"):
r(h(l,"offline_active_box"))},La=function(b){b?(v(h(l,"subiz_offline")),N("offline"),g.widget_window="message_offline"):r(h(l,"subiz_offline"))},Ra=function(b){var c=k.visitor;b?(b=!0,c.name&&(b=!1,L("name",c.name)),c.email&&(b=!1,L("email",c.email)),b?(Fa(0),La(1)):(La(0),Fa(1)),g.widget_window="message_offline"):(La(0),Fa(0))},za=function(b){b?(v(h(l,"message_successful")),N("offline"),g.widget_window="thank_you"):r(h(l,"message_successful"))},Aa=function(b,c){c=$b.link(c,{stripPrefix:!0});(b=b||
"")&&!b.name&&(b={name:"Agent",avatar:g.url_avatar});var d=""==b?"visitor_chat":"supporter_chat",e=q.last(Y(f,".subiz_conversionin > div.visitor_chat, div.supporter_chat")),h="";if(e&&"undefined"!=typeof b.name){var l=H(q.last(Y(e,"label.name")));D.get(e,"class")==d&&b.name!=l&&(e=null)}(l=q.last(Y(f,".subiz_conversionin > div")))&&"text_notice_inline"==D.get(l,"class")&&(e=null);e&&D.get(e,"class")==d?(h=""==b?'<div class="line_message"><span class="visitor_content_chat">'+c+"</span></div>":'<div class="line_message"><img src="'+
R(b.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+c+"</span></div>",$(e,h)):(""==b?(d="Me",k.lang.online.visitor_name&&(d=k.lang.online.visitor_name),h='<div class="visitor_chat"><label class="name"><a href="javascript:;" class="visitor_name">'+q.escape(k.visitor.name||d)+'</a></label><div class="line_message"><span class="visitor_content_chat">'+c+"</span></div></div>"):h='<div class="supporter_chat"><label class="name">'+q.escape(b.name)+'</label><div class="line_message"><img src="'+
R(b.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+c+"</span></div></div>",m(f,"subiz_conversionin",function(b){$(b,h)}));Bb()},va=function(b){"enable"==b?(Y(f,"input[type=text], textarea, select",function(b){D.remove(b,"disabled")}),Y(l,"input[type=text], textarea, select",function(b){D.remove(b,"disabled")})):(Y(f,"input[type=text], textarea, select",function(b){D.set(b,"disabled",!0)}),Y(l,"input[type=text], textarea, select",function(b){D.set(b,"disabled",!0)}))},
Oa=function(b){b?m(f,"message_welcome",function(b){v(b)}):m(f,"message_welcome",function(b){r(b)})},yb=function(b){b?v(h(f,"subiz_loading")):r(h(f,"subiz_loading"))},zb=function(b){b?v(h(l,"subiz_loading")):r(h(l,"subiz_loading"))},Ua=function(b){b?Y(f,".widget_body_footer .btnendchat",function(b){v(b)}):Y(f,".widget_body_footer .btnendchat",function(b){r(b)})},Va=function(b,c){b?q.each(k.agents,function(b){if(b.username==c){t("UI typing : found agent");var e=k.lang.online.typing.replace("{agent}",
q.escape(b.name));m(f,"text_notice",function(b){H(b,e);v(b)})}}):m(f,"text_notice",function(b){r(b)})},ua=function(b){var c=q.template('<div class="text_notice_inline"><%= message %></div>',{message:b});m(f,"subiz_conversionin",function(b){$(b,c)});Bb()},wb=function(b,c){var d=q.template('<div class="chat_warning notification_widget '+("undefined"==typeof c?"":"notification_"+c)+'"><label class="name_chat_warning"><%= message %></label><a href="javascript:;" class="close_notification_widget"><i class="widget-sprites icon_actions icon_delete"></i></a></div>',
{message:b});"online"==g.status_widget?(m(f,"chat_warning",function(b){ba(b)}),m(f,"widget_body_inner",function(b){$(b,d)})):(m(l,"chat_warning",function(b){ba(b)}),m(l,"widget_body_inner",function(b){$(b,d)}))},ga=function(b){b?v(h(f,"subiz-bubble")):r(h(f,"subiz-bubble"))},wc=function(b){b?m(f,"logo_company",function(b){v(b)}):m(f,"logo_company",function(b){r(b)})},vc=function(){m(f,"notice_new_message",function(b){H(b,"0");r(b)});ma()},Bb=function(){m(f,"subiz_conversionin",function(b){b.scrollHeight&&
(b.scrollTop=b.scrollHeight)})};if(0<Ya[ta[3]])for(Ya[ta[4]]();Ya[ta[3]];){var Bc=Ya[ta[5]]();Zb(Bc)}n[ta[6]]={};n[ta[6]][Ac]=Zb}})(this,document,_sbzq);
